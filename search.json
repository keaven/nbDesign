[{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"trial-design-parameters","dir":"Articles","previous_headings":"","what":"Trial Design Parameters","title":"Group Sequential Design and Simulation","text":"design trial following characteristics: Enrollment: 12 months constant rate Trial Duration: 24 months Interim 1: 10 months Interim 2: 18 months Final: 24 months Control: 0.125 events per month (1.5 per year) Experimental: 0.0833 events per month (1.0 per year; rate ratio = 0.67) Dispersion: 0.5 Power: 90% (beta = 0.1) Alpha: 0.025 (one-sided)","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"sample-size-calculation","dir":"Articles","previous_headings":"Trial Design Parameters","what":"Sample Size Calculation","title":"Group Sequential Design and Simulation","text":"First, calculate required sample size fixed design:","code":"# Sample size calculation # Enrollment: constant rate over 12 months # Trial duration: 24 months event_gap_val <- 20 / 30.4375 # Minimum gap between events is 20 days (approx)  nb_ss <- sample_size_nbinom(   lambda1 = 1.5 / 12,      # Control event rate (per month)   lambda2 = 1.0 / 12,      # Experimental event rate (per month)   dispersion = 0.5,        # Overdispersion parameter   power = 0.9,             # 90% power   alpha = 0.025,           # One-sided alpha   accrual_rate = 100 / 12, # Patients per month (will determine total n)   accrual_duration = 12,   # 12 months enrollment   trial_duration = 24,     # 24 months trial   max_followup = 12,       # 12 months of follow-up per patient   event_gap = event_gap_val,   method = \"zhu\"           # Zhu and Lakkis sample size method )  # Print key results cat(\"Fixed design\\n\") #> Fixed design nb_ss #> Sample Size for Negative Binomial Outcome #> ========================================== #>  #> Method:          zhu #> Sample size:     n1 = 178, n2 = 178, total = 356 #> Expected events: 415.5 (n1: 246.7, n2: 168.8) #> Power: 90%, Alpha: 0.025 (1-sided) #> Rates: control = 0.1250, treatment = 0.0833 (RR = 0.6667) #> Dispersion: 0.5000, Avg exposure (calendar): 12.00 #> Avg exposure (at-risk): n1 = 11.09, n2 = 11.38 #> Accrual: 12.0, Trial duration: 24.0 #> Max follow-up: 12.0"},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"group-sequential-design","dir":"Articles","previous_headings":"Trial Design Parameters","what":"Group Sequential Design","title":"Group Sequential Design and Simulation","text":"Now convert group sequential design 3 analyses 10, 18 24 months. Note final analysis time must fixed design. relative enrollment rates increased increase sample size standard group sequential design theory. specify usTime = c(0.1, 0.2, 1) along sfLinear() spending function spend 10%, 20% 100% cumulative Î±\\alpha 3 planned analyses regardless observed statistical information analysis. Textual group sequential design summary: Tabular summary:","code":"# Analysis times (in months) analysis_times <- c(10, 18, 24)  # Create group sequential design with integer sample sizes gs_nb <- gsNBCalendar(   x = nb_ss,               # Input fixed design for negative binomial   k = 3,                   # 3 analyses   test.type = 4,           # Two-sided asymmetric, non-binding futility   sfu = sfLinear,          # Linear spending function for upper bound   sfupar = c(.5, .5),      # Identity function   sfl = sfHSD,             # HSD spending for lower bound   sflpar = -8,             # Conservative futility bound   lsTime = NULL,           # Spending based on information   analysis_times = analysis_times  # Calendar times in months ) |> toInteger() # Round to integer sample size summary(gs_nb) #> Asymmetric two-sided with non-binding futility bound group sequential design #> for negative binomial outcomes, 3 analyses, total sample size 396.0, 90 percent #> power, 2.5 percent (1-sided) Type I error. Control rate 0.1250, treatment rate #> 0.0833, risk ratio 0.6667, dispersion 0.5000. Accrual duration 12.0, trial #> duration 24.0, max follow-up 12.0, average exposure (calendar) 12.00, (at-risk #> n1=11.09, n2=11.38). Randomization ratio 1:1. gs_nb |>    gsDesign::gsBoundSummary(     deltaname = \"RR\",      logdelta = TRUE,     Nname = \"Information\",     timename = \"Month\",     digits = 4,     ddigits = 2   ) |>   gt() |>   tab_header(     title = \"Group Sequential Design Bounds for Negative Binomial Outcome\",     subtitle = paste0(\"N = \", ceiling(gs_nb$n_total[gs_nb$k]),                        \", Expected events = \", round(gs_nb$nb_design$total_events, 1))   )"},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"simulation-study","dir":"Articles","previous_headings":"","what":"Simulation Study","title":"Group Sequential Design and Simulation","text":"now simulate 50 trials evaluate operating characteristics group sequential design.","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"simulation-setup","dir":"Articles","previous_headings":"Simulation Study","what":"Simulation Setup","title":"Group Sequential Design and Simulation","text":"","code":"set.seed(42) n_sims <- 50  # Enrollment rate (patients per month) to achieve target sample size n_target <- ceiling(nb_ss$n_total) enroll_rate_val <- n_target / 12  # All enrolled in 12 months  # Define enrollment enroll_rate <- data.frame(   rate = enroll_rate_val,   duration = 12  # 12 months enrollment )  # Define failure rates (with dispersion) fail_rate <- data.frame(   treatment = c(\"Control\", \"Experimental\"),   rate = c(1.5 / 12, 1.0 / 12),   dispersion = c(0.5, 0.5) )  # No dropout for simplicity dropout_rate <- NULL  # Maximum follow-up (trial duration from enrollment start) max_followup <- 24  # 24 months"},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"run-simulations","dir":"Articles","previous_headings":"Simulation Study","what":"Run Simulations","title":"Group Sequential Design and Simulation","text":"","code":"# Storage for results results <- vector(\"list\", n_sims)  for (sim in 1:n_sims) {   # Simulate trial data   sim_data <- nb_sim(     enroll_rate = enroll_rate,     fail_rate = fail_rate,     dropout_rate = dropout_rate,     max_followup = max_followup,     n = n_target   )      # Analyze at each interim   sim_results <- data.frame(     sim = sim,     analysis = 1:3,     analysis_time = analysis_times,     n_enrolled = NA_integer_,     events_ctrl = NA_integer_,     events_exp = NA_integer_,     events_total = NA_integer_,     exposure_ctrl = NA_real_,     exposure_exp = NA_real_,     blinded_info = NA_real_,     unblinded_info = NA_real_,     z_stat = NA_real_,     p_value = NA_real_,     cross_upper = NA,     cross_lower = NA   )      stopped <- FALSE      for (k in 1:3) {     if (stopped) {       # Trial already stopped at earlier analysis       sim_results$cross_upper[k] <- FALSE       sim_results$cross_lower[k] <- FALSE       next     }          # Cut data at analysis time     cut_time <- analysis_times[k]     cut_data <- cut_data_by_date(sim_data, cut_date = cut_time, event_gap = event_gap_val)          # Count enrolled subjects (those with enroll_time <= cut_time)     enrolled <- unique(sim_data$id[sim_data$enroll_time <= cut_time])     cut_data <- cut_data[cut_data$id %in% enrolled, ]          # Summary by treatment     summary_dt <- as.data.table(cut_data)[       ,       .(n = .N, events = sum(events), exposure = sum(tte)),       by = treatment     ]          ctrl_row <- summary_dt[treatment == \"Control\"]     exp_row <- summary_dt[treatment == \"Experimental\"]          sim_results$n_enrolled[k] <- nrow(cut_data)     sim_results$events_ctrl[k] <- if (nrow(ctrl_row) > 0) ctrl_row$events else 0     sim_results$events_exp[k] <- if (nrow(exp_row) > 0) exp_row$events else 0     sim_results$events_total[k] <- sim_results$events_ctrl[k] + sim_results$events_exp[k]     sim_results$exposure_ctrl[k] <- if (nrow(ctrl_row) > 0) ctrl_row$exposure else 0     sim_results$exposure_exp[k] <- if (nrow(exp_row) > 0) exp_row$exposure else 0          # Run MÃ¼tze test     if (nrow(cut_data) >= 4 && sim_results$events_total[k] >= 2) {       test_result <- tryCatch(         mutze_test(cut_data),         error = function(e) NULL       )              if (!is.null(test_result)) {         sim_results$z_stat[k] <- test_result$z         sim_results$p_value[k] <- test_result$p_value                  # Calculate unblinded information (approx)         evt_ctrl <- sim_results$events_ctrl[k]         evt_exp <- sim_results$events_exp[k]         if (evt_ctrl > 0 && evt_exp > 0) {            sim_results$unblinded_info[k] <- 1 / (1/evt_ctrl + 1/evt_exp)         }                  # Calculate blinded information and update bounds         blinded_est <- calculate_blinded_info(           cut_data,           ratio = nb_ss$inputs$ratio,           lambda1_planning = nb_ss$inputs$lambda1,           lambda2_planning = nb_ss$inputs$lambda2         )         sim_results$blinded_info[k] <- blinded_est$blinded_info                  # Update design with observed information fraction         max_info <- gs_nb$n.fix         if (k == 3) {           frac <- 1         } else {           frac <- min(blinded_est$blinded_info / max_info, 0.999)         }                  # Current timing         current_timing <- gs_nb$timing         current_timing[k] <- frac                  # Safety check for timing order         if (k > 1 && current_timing[k] <= current_timing[k-1]) current_timing[k] <- current_timing[k-1] + 0.001         if (k < 3 && current_timing[k+1] <= current_timing[k]) current_timing[k+1] <- current_timing[k] + 0.001                  # Recompute bounds         temp_gs <- gsDesign::gsDesign(           k = 3,           test.type = 4,           alpha = 0.025,           beta = 0.1,           sfu = gsDesign::sfLinear, sfupar = c(.5, .5),           sfl = gsDesign::sfHSD, sflpar = -8,           timing = current_timing,           n.fix = max_info         )                  upper_bound <- temp_gs$upper$bound[k]         lower_bound <- temp_gs$lower$bound[k]                  # Check boundaries (one-sided: reject if z < -upper bound for benefit)         # For rate ratio < 1 (experimental better), log(RR) < 0, so z < 0         z_eff <- -test_result$z  # Flip sign for efficacy direction                  sim_results$cross_upper[k] <- z_eff > upper_bound         sim_results$cross_lower[k] <- z_eff < lower_bound                  if (sim_results$cross_upper[k] || sim_results$cross_lower[k]) {           stopped <- TRUE         }       }     }   }      results[[sim]] <- sim_results }  # Combine all results all_results <- do.call(rbind, results)"},{"path":[]},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"events-and-exposure-by-analysis","dir":"Articles","previous_headings":"Simulation Results Summary","what":"Events and Exposure by Analysis","title":"Group Sequential Design and Simulation","text":"","code":"# Summarize by analysis summary_by_analysis <- as.data.table(all_results)[   ,   .(     mean_enrolled = mean(n_enrolled, na.rm = TRUE),     mean_events_total = mean(events_total, na.rm = TRUE),     mean_events_ctrl = mean(events_ctrl, na.rm = TRUE),     mean_events_exp = mean(events_exp, na.rm = TRUE),     mean_exposure_ctrl = mean(exposure_ctrl, na.rm = TRUE),     mean_exposure_exp = mean(exposure_exp, na.rm = TRUE),     mean_z = mean(z_stat, na.rm = TRUE),     sd_z = sd(z_stat, na.rm = TRUE)   ),   by = .(analysis, analysis_time) ]  summary_by_analysis |>   gt() |>   tab_header(title = \"Summary Statistics by Analysis\") |>   cols_label(     analysis = \"Analysis\",     analysis_time = \"Time (months)\",     mean_enrolled = \"N Enrolled\",     mean_events_total = \"Total Events\",     mean_events_ctrl = \"Ctrl Events\",     mean_events_exp = \"Exp Events\",     mean_exposure_ctrl = \"Ctrl Exposure\",     mean_exposure_exp = \"Exp Exposure\",     mean_z = \"Mean Z\",     sd_z = \"SD Z\"   ) |>   fmt_number(decimals = 2)"},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"statistical-information","dir":"Articles","previous_headings":"Simulation Results Summary","what":"Statistical Information","title":"Group Sequential Design and Simulation","text":"statistical information analysis proportional precision treatment effect estimate. negative binomial outcomes, relates total exposure event counts.","code":"# Summarize information (using blinded estimate from simulation) info_by_analysis <- as.data.table(all_results)[   ,   .(     mean_blinded = mean(blinded_info, na.rm = TRUE),     mean_unblinded = mean(unblinded_info, na.rm = TRUE)   ),   by = analysis ]  # Add planned information from design info_by_analysis[, planned_info := gs_nb$n.I[analysis]]  # Normalize to get observed information fractions (relative to planned max) max_planned_info <- tail(gs_nb$n.I, 1) info_by_analysis[, observed_frac_blinded := mean_blinded / max_planned_info] info_by_analysis[, observed_frac_unblinded := mean_unblinded / max_planned_info] info_by_analysis[, planned_info_frac := planned_info / max_planned_info]  info_by_analysis |>   gt() |>   tab_header(title = \"Information by Analysis\") |>   cols_label(     analysis = \"Analysis\",     mean_blinded = \"Mean Info (Blinded)\",     mean_unblinded = \"Mean Info (Unblinded)\",     planned_info = \"Planned Info\",     planned_info_frac = \"Planned Frac\",     observed_frac_blinded = \"Obs Frac (Blind)\",     observed_frac_unblinded = \"Obs Frac (Unblind)\"   ) |>   fmt_number(decimals = 3)"},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"boundary-crossings-and-power","dir":"Articles","previous_headings":"Simulation Results Summary","what":"Boundary Crossings and Power","title":"Group Sequential Design and Simulation","text":"","code":"# Calculate crossing probabilities crossing_summary <- as.data.table(all_results)[   ,   .(     n_cross_upper = sum(cross_upper, na.rm = TRUE),     n_cross_lower = sum(cross_lower, na.rm = TRUE),     n_continue = sum(!cross_upper & !cross_lower, na.rm = TRUE)   ),   by = analysis ]  crossing_summary[, prob_cross_upper := n_cross_upper / n_sims] crossing_summary[, prob_cross_lower := n_cross_lower / n_sims]  # Cumulative power (Sim) crossing_summary[, cum_prob_cross_upper := cumsum(prob_cross_upper)]  # Cumulative power (Design) # Drift parameter for alternative: |log(RR)| * sqrt(I_max) # Note: gs_nb$n.fix is the information at final analysis log_rr <- log(nb_ss$inputs$lambda2 / nb_ss$inputs$lambda1) theta <- abs(log_rr) * sqrt(gs_nb$n.fix) design_probs <- gsDesign::gsProbability(d = gs_nb, theta = theta) crossing_summary[, design_cum_power := cumsum(design_probs$upper$prob)[analysis]]  crossing_summary[, .(analysis, n_cross_upper, cum_prob_cross_upper, design_cum_power)] |>   gt() |>   tab_header(title = \"Boundary Crossing and Power\") |>   cols_label(     analysis = \"Analysis\",     n_cross_upper = \"N Cross Upper\",     cum_prob_cross_upper = \"Cum Power (Sim)\",     design_cum_power = \"Cum Power (Design)\"   ) |>   fmt_number(columns = contains(\"power\"), decimals = 3)"},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"overall-power","dir":"Articles","previous_headings":"Simulation Results Summary","what":"Overall Power","title":"Group Sequential Design and Simulation","text":"","code":"# Determine if each simulation crossed the efficacy boundary at any analysis efficacy_by_sim <- as.data.table(all_results)[   ,   .(efficacy = any(cross_upper, na.rm = TRUE)),   by = sim ]  overall_power <- mean(efficacy_by_sim$efficacy, na.rm = TRUE)  # Futility stopping futility_by_sim <- as.data.table(all_results)[   ,   .(futility = any(cross_lower, na.rm = TRUE) & !any(cross_upper, na.rm = TRUE)),   by = sim ]  overall_futility <- mean(futility_by_sim$futility, na.rm = TRUE)  cat(\"\\n=== Overall Operating Characteristics ===\\n\") #>  #> === Overall Operating Characteristics === cat(sprintf(\"Number of simulations: %d\\n\", n_sims)) #> Number of simulations: 50 cat(sprintf(\"Overall Power (P[reject H0]): %.1f%%\\n\", overall_power * 100)) #> Overall Power (P[reject H0]): 94.0% cat(sprintf(\"Futility Stopping Rate: %.1f%%\\n\", overall_futility * 100)) #> Futility Stopping Rate: 6.0% cat(sprintf(\"Design Power (target): %.1f%%\\n\", (1 - gs_nb$beta) * 100)) #> Design Power (target): 90.0%"},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"visualization-of-z-statistics","dir":"Articles","previous_headings":"Simulation Results Summary","what":"Visualization of Z-Statistics","title":"Group Sequential Design and Simulation","text":"","code":"# Prepare data for plotting plot_data <- all_results plot_data$z_flipped <- -plot_data$z_stat  # Flip for efficacy direction  # Boundary data bounds_df <- data.frame(   analysis = 1:3,   upper = gs_nb$upper$bound,   lower = gs_nb$lower$bound )  ggplot(plot_data, aes(x = factor(analysis), y = z_flipped)) +   geom_violin(fill = \"steelblue\", alpha = 0.5, color = \"steelblue\") +   geom_boxplot(width = 0.1, fill = \"white\", outlier.shape = NA) +   # Draw bounds as lines connecting analyses   geom_line(data = bounds_df, aes(x = analysis, y = upper, group = 1),               linetype = \"dashed\", color = \"darkgreen\", linewidth = 1) +   geom_line(data = bounds_df, aes(x = analysis, y = lower, group = 1),               linetype = \"dashed\", color = \"darkred\", linewidth = 1) +   # Draw points for bounds   geom_point(data = bounds_df, aes(x = analysis, y = upper), color = \"darkgreen\") +   geom_point(data = bounds_df, aes(x = analysis, y = lower), color = \"darkred\") +   geom_hline(yintercept = 0, color = \"gray50\") +   labs(     title = \"Simulated Z-Statistics by Analysis\",     subtitle = \"Green dashed = efficacy bound, Red dashed = futility bound\",     x = \"Analysis\",     y = \"Z-statistic (positive = favors experimental)\"   ) +   theme_minimal() +   ylim(c(-4, 6)) #> Warning: Removed 58 rows containing non-finite outside the scale range #> (`stat_ydensity()`). #> Warning: Removed 58 rows containing non-finite outside the scale range #> (`stat_boxplot()`)."},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"design-summary","dir":"Articles","previous_headings":"","what":"Design Summary","title":"Group Sequential Design and Simulation","text":"summary() function provides textual overview group sequential design: detailed boundary information, use gsBoundSummary(). set logdelta = TRUE since test statistic based log rate ratio. ~RR bound displays rate ratio (Î»2/Î»1\\lambda_2/\\lambda_1), values < 1 indicate treatment benefit: Note P(Cross) RR=0.67 corresponds designâ€™s alternate hypothesis (treatment rate / control rate = 0.67). Sample sizes analysis: rounding integer sample sizes toInteger():","code":"summary(gs_nb) #> Asymmetric two-sided with non-binding futility bound group sequential design #> for negative binomial outcomes, 3 analyses, total sample size 396.0, 90 percent #> power, 2.5 percent (1-sided) Type I error. Control rate 0.1250, treatment rate #> 0.0833, risk ratio 0.6667, dispersion 0.5000. Accrual duration 12.0, trial #> duration 24.0, max follow-up 12.0, average exposure (calendar) 12.00, (at-risk #> n1=11.09, n2=11.38). Randomization ratio 1:1. gsDesign::gsBoundSummary(gs_nb,                           deltaname = \"RR\",                           logdelta = TRUE,                          Nname = \"Information\",                          timename = \"Month\",                          digits = 4,                          ddigits = 2) |>   gt() |>   tab_header(     title = \"Group Sequential Design Bounds for Negative Binomial Outcome\",     subtitle = paste0(\"N = \", ceiling(gs_nb$n_total[gs_nb$k]),                        \", Expected events = \", round(gs_nb$nb_design$total_events, 1))   ) data.frame(   Analysis = 1:gs_nb$k,   n1 = gs_nb$n1,   n2 = gs_nb$n2,   n_total = gs_nb$n_total ) |>   gt() |>   tab_header(title = \"Sample Sizes at Each Analysis\") |>   fmt_number(columns = c(n1, n2, n_total), decimals = 1) gs_nb_int <- toInteger(gs_nb) summary(gs_nb_int) #> Asymmetric two-sided with non-binding futility bound group sequential design #> for negative binomial outcomes, 3 analyses, total sample size 396.0, 90 percent #> power, 2.5 percent (1-sided) Type I error. Control rate 0.1250, treatment rate #> 0.0833, risk ratio 0.6667, dispersion 0.5000. Accrual duration 12.0, trial #> duration 24.0, max follow-up 12.0, average exposure (calendar) 12.00, (at-risk #> n1=11.09, n2=11.38). Randomization ratio 1:1."},{"path":"https://keaven.github.io/gsDesignNB/articles/group_sequential_simulation.html","id":"notes","dir":"Articles","previous_headings":"","what":"Notes","title":"Group Sequential Design and Simulation","text":"simulation demonstrates basic workflow group sequential designs negative binomial outcomes: Sample size calculation using sample_size_nbinom() fixed design Group sequential design using gsNBCalendar() add interim analyses Simulation using nb_sim() generate trial data Analysis using cut_data_by_date() mutze_test() interim Boundary checking group sequential bounds usTime = c(0.1, 0.2, 1) specification provides conservative alpha spending early analyses, preserving Type error later analyses information available. 50 simulations, estimated power substantial Monte Carlo error. precise estimates, increase n_sims 1000 .","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"methodology","dir":"Articles","previous_headings":"","what":"Methodology","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"assume outcome YY follows negative binomial distribution mean Î¼\\mu dispersion parameter kk, variance given : Var(Y)=Î¼+kÎ¼2 Var(Y) = \\mu + k \\mu^2 Note Râ€™s rnbinom parameterization, k=1/ðšœðš’ðš£ðšŽk = 1/\\texttt{size}. wish test null hypothesis H0:Î»1=Î»2H_0: \\lambda_1 = \\lambda_2 alternative H1:Î»1â‰ Î»2H_1: \\lambda_1 \\neq \\lambda_2, Î»1\\lambda_1 Î»2\\lambda_2 event rates control treatment groups, respectively. function implements two methods:","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"method-1-zhu-and-lakkis-2014","dir":"Articles","previous_headings":"Methodology","what":"Method 1: Zhu and Lakkis (2014)","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"method based asymptotic normality log rate ratio. sample size control group (n1n_1) : n1=(zÎ±/s+zÎ²)2â‹…V(log(Î¼1/Î¼2))2 n_1 = \\frac{(z_{\\alpha/s} + z_{\\beta})^2 \\cdot V}{(\\log(\\mu_1/\\mu_2))^2} VV variance component: V=(1Î¼1+k)+1r(1Î¼2+k) V = \\left(\\frac{1}{\\mu_1} + k\\right) + \\frac{1}{r}\\left(\\frac{1}{\\mu_2} + k\\right) r=n2/n1r = n_2/n_1 allocation ratio, Î¼i=Î»iâ‹…t\\mu_i = \\lambda_i \\cdot t expected mean count exposure duration tt.","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"method-2-friede-and-schmidli-2010-mÃ¼tze-et-al--2018","dir":"Articles","previous_headings":"Methodology","what":"Method 2: Friede and Schmidli (2010) / MÃ¼tze et al.Â (2018)","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"method uses Wald test statistic commonly used group sequential designs (implemented gscounts package). total sample size ntotaln_{total} calculated : ntotal=(zÎ±/s+zÎ²)2â‹…Vâ€¾(log(Î»1/Î»2))2 n_{total} = \\frac{(z_{\\alpha/s} + z_{\\beta})^2 \\cdot \\bar{V}}{(\\log(\\lambda_1/\\lambda_2))^2} Vâ€¾\\bar{V} average variance per subject: Vâ€¾=1/Î¼1+kp1+1/Î¼2+kp2 \\bar{V} = \\frac{1/ \\mu_1 + k}{p_1} + \\frac{1/ \\mu_2 + k}{p_2} p1=n1/ntotalp_1 = n_1/n_{total} p2=n2/ntotalp_2 = n_2/n_{total} allocation proportions. Note: fixed design equal allocation, methods yield identical sample sizes.","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"average-exposure-with-variable-accrual-and-dropout","dir":"Articles","previous_headings":"","what":"Average Exposure with Variable Accrual and Dropout","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"accrual rate constant trial fixed duration ongoing recruitment, exposure time patients vary. function calculates average exposure time use sample size formula. Additionally, dropout_rate specified, exposure adjusted account patients leaving study early. Let TT total trial duration. Suppose recruitment occurs JJ segments, jj-th segment accrual rate RjR_j duration DjD_j. dropout_rate 0: number patients recruited segment jj Nj=Rjâ‹…DjN_j = R_j \\cdot D_j. start time segment jj Sjâˆ’1=âˆ‘=1jâˆ’1DiS_{j-1} = \\sum_{=1}^{j-1} D_i (S0=0S_0 = 0). midpoint recruitment segment jj Mj=Sjâˆ’1+Dj/2M_j = S_{j-1} + D_j/2. average follow-(exposure) time patients recruited segment jj approximately Ej=Tâˆ’MjE_j = T - M_j. dropout_rate (Î´\\delta) > 0, average exposure calculated integrating exposure function recruitment interval: Ej=1Î´âˆ’1Î´2Dj(eâˆ’Î´uminâˆ’eâˆ’Î´umax) E_j = \\frac{1}{\\delta} - \\frac{1}{\\delta^2 D_j} \\left( e^{-\\delta u_{min}} - e^{-\\delta u_{max}} \\right)  umaxu_{max} uminu_{min} maximum minimum potential follow-times patients segment (Tâˆ’Sjâˆ’1T - S_{j-1} Tâˆ’(Sjâˆ’1+Dj)T - (S_{j-1} + D_j) respectively).","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"maximum-follow-up","dir":"Articles","previous_headings":"Average Exposure with Variable Accrual and Dropout","what":"Maximum Follow-up","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"max_followup (FF) specified, follow-time individual capped FF. creates three scenarios recruitment segment: truncated: uminâ‰¥Fu_{min} \\ge F, patients segment potential follow-â‰¥F\\ge F, actual follow-FF (subject dropout). None truncated: umaxâ‰¤Fu_{max} \\le F, patients reach cap FF trial ends. calculation . Partial truncation: umin<F<umaxu_{min} < F < u_{max}, patients recruited earlier segment capped FF, recruited later followed trial end. segment split two parts calculation. overall average exposure used calculation weighted average: tâ€¾=âˆ‘j=1JNjEjâˆ‘j=1JNj \\bar{t} = \\frac{\\sum_{j=1}^J N_j E_j}{\\sum_{j=1}^J N_j}","code":""},{"path":[]},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"basic-calculation-zhu-and-lakkis","dir":"Articles","previous_headings":"Examples","what":"Basic Calculation (Zhu and Lakkis)","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"Calculate sample size : * Control rate Î»1=0.5\\lambda_1 = 0.5 * Treatment rate Î»2=0.3\\lambda_2 = 0.3 * Dispersion k=0.1k = 0.1 * Power = 80% * Alpha = 0.025 (one-sided) * Accrual 12 months * Trial duration 12 months (implying exposure approx 6 months)","code":"sample_size_nbinom(   lambda1 = 0.5,   lambda2 = 0.3,   dispersion = 0.1,   power = 0.8,   alpha = 0.025,   sided = 1,   accrual_rate = 10, # arbitrary, just for average exposure   accrual_duration = 12,   trial_duration = 12,   method = \"zhu\" ) #> Sample Size for Negative Binomial Outcome #> ========================================== #>  #> Method:          zhu #> Sample size:     n1 = 33, n2 = 33, total = 66 #> Expected events: 158.4 (n1: 99.0, n2: 59.4) #> Power: 80%, Alpha: 0.025 (1-sided) #> Rates: control = 0.5000, treatment = 0.3000 (RR = 0.6000) #> Dispersion: 0.1000, Avg exposure (calendar): 6.00 #> Accrual: 12.0, Trial duration: 12.0"},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"using-friede-et-al--method","dir":"Articles","previous_headings":"Examples","what":"Using Friede et al.Â Method","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"","code":"sample_size_nbinom(   lambda1 = 0.5,   lambda2 = 0.3,   dispersion = 0.1,   power = 0.8,   alpha = 0.025,   sided = 1,   accrual_rate = 10,   accrual_duration = 12,   trial_duration = 12,   method = \"friede\" ) #> Sample Size for Negative Binomial Outcome #> ========================================== #>  #> Method:          friede #> Sample size:     n1 = 33, n2 = 33, total = 66 #> Expected events: 158.4 (n1: 99.0, n2: 59.4) #> Power: 80%, Alpha: 0.025 (1-sided) #> Rates: control = 0.5000, treatment = 0.3000 (RR = 0.6000) #> Dispersion: 0.1000, Avg exposure (calendar): 6.00 #> Accrual: 12.0, Trial duration: 12.0"},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"piecewise-constant-accrual","dir":"Articles","previous_headings":"Examples","what":"Piecewise Constant Accrual","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"Consider trial recruitment ramps : * 5 patients/month first 3 months * 10 patients/month next 3 months * Total trial duration 12 months function automatically calculates average exposure based accrual pattern.","code":"sample_size_nbinom(   lambda1 = 0.5,   lambda2 = 0.3,   dispersion = 0.1,   power = 0.8,   accrual_rate = c(5, 10),   accrual_duration = c(3, 3),   trial_duration = 12 ) #> Sample Size for Negative Binomial Outcome #> ========================================== #>  #> Method:          zhu #> Sample size:     n1 = 25, n2 = 25, total = 50 #> Expected events: 170.0 (n1: 106.2, n2: 63.7) #> Power: 80%, Alpha: 0.025 (1-sided) #> Rates: control = 0.5000, treatment = 0.3000 (RR = 0.6000) #> Dispersion: 0.1000, Avg exposure (calendar): 8.50 #> Accrual: 6.0, Trial duration: 12.0"},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"accrual-with-dropout-and-max-follow-up","dir":"Articles","previous_headings":"Examples","what":"Accrual with Dropout and Max Follow-up","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"design , 5% dropout rate per unit time maximum follow-6 months.","code":"sample_size_nbinom(   lambda1 = 0.5,   lambda2 = 0.3,   dispersion = 0.1,   power = 0.8,   accrual_rate = c(5, 10),   accrual_duration = c(3, 3),   trial_duration = 12,   dropout_rate = 0.05,   max_followup = 6 ) #> Sample Size for Negative Binomial Outcome #> ========================================== #>  #> Method:          zhu #> Sample size:     n1 = 37, n2 = 37, total = 74 #> Expected events: 153.4 (n1: 95.9, n2: 57.5) #> Power: 80%, Alpha: 0.025 (1-sided) #> Rates: control = 0.5000, treatment = 0.3000 (RR = 0.6000) #> Dispersion: 0.1000, Avg exposure (calendar): 5.18 #> Accrual: 6.0, Trial duration: 12.0 #> Max follow-up: 6.0"},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"calculating-power-for-fixed-design","dir":"Articles","previous_headings":"Examples","what":"Calculating Power for Fixed Design","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"Using accrual rates design previous example, suppose want calculate power treatment effect smaller (Î»2=0.4\\lambda_2 = 0.4 instead 0.30.3). use accrual_rate computed previous step.","code":"# Store the result from the previous calculation design_result <- sample_size_nbinom(   lambda1 = 0.5,   lambda2 = 0.3,   dispersion = 0.1,   power = 0.8,   accrual_rate = c(5, 10),   accrual_duration = c(3, 3),   trial_duration = 12,   dropout_rate = 0.05,   max_followup = 6 )  # Use the computed accrual rates to calculate power for a smaller effect size sample_size_nbinom(   lambda1 = 0.5,   lambda2 = 0.4, # Smaller effect size   dispersion = 0.1,   power = NULL, # Request power calculation   accrual_rate = design_result$accrual_rate, # Use computed rates   accrual_duration = c(3, 3),   trial_duration = 12,   dropout_rate = 0.05,   max_followup = 6 ) #> Sample Size for Negative Binomial Outcome #> ========================================== #>  #> Method:          zhu #> Sample size:     n1 = 37, n2 = 37, total = 74 #> Expected events: 172.6 (n1: 95.9, n2: 76.7) #> Power: 26%, Alpha: 0.025 (1-sided) #> Rates: control = 0.5000, treatment = 0.4000 (RR = 0.8000) #> Dispersion: 0.1000, Avg exposure (calendar): 5.18 #> Accrual: 6.0, Trial duration: 12.0 #> Max follow-up: 6.0"},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"unequal-allocation","dir":"Articles","previous_headings":"Examples","what":"Unequal Allocation","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"Sample size 2:1 allocation ratio (n2=2n1n_2 = 2 n_1).","code":"sample_size_nbinom(   lambda1 = 0.5,   lambda2 = 0.3,   dispersion = 0.1,   ratio = 2,   accrual_rate = 10,   accrual_duration = 12,   trial_duration = 12 ) #> Sample Size for Negative Binomial Outcome #> ========================================== #>  #> Method:          zhu #> Sample size:     n1 = 40, n2 = 80, total = 120 #> Expected events: 264.0 (n1: 120.0, n2: 144.0) #> Power: 96%, Alpha: 0.025 (1-sided) #> Rates: control = 0.5000, treatment = 0.3000 (RR = 0.6000) #> Dispersion: 0.1000, Avg exposure (calendar): 6.00 #> Accrual: 12.0, Trial duration: 12.0"},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"accounting-for-event-gaps","dir":"Articles","previous_headings":"","what":"Accounting for Event Gaps","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"recurrent event trials, may mandatory â€œgapâ€ period event new events can recorded (e.g., recovery period administrative window). effectively reduces time risk. event_gap (gg) specified, function adjusts calculation follows: Effective Rates: event rates adjusted Î»*=Î»/(1+Î»g)\\lambda^* = \\lambda / (1 + \\lambda g) sample size calculation (Zhu Lakkis method). -Risk Exposure: function reports â€œaverage -risk exposureâ€ Erisk=Ecal/(1+Î»g)E_{risk} = E_{cal} / (1 + \\lambda g) alongside standard calendar exposure. provides transparency actual time subjects risk events. Since gap reduction depends event rate (Î»\\lambda), -risk exposure differs treatment groups rates differ.","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"example-with-event-gap","dir":"Articles","previous_headings":"Accounting for Event Gaps","what":"Example with Event Gap","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"Calculate sample size assuming 5-day gap event (approx 0.0137 years). output shows â€œAvg exposure (calendar)â€ â€œAvg exposure (-risk)â€ group.","code":"sample_size_nbinom(   lambda1 = 0.5,   lambda2 = 0.3,   dispersion = 0.1,   power = 0.8,   accrual_rate = 10,   accrual_duration = 12,   trial_duration = 12,   event_gap = 5 / 365.25 ) #> Sample Size for Negative Binomial Outcome #> ========================================== #>  #> Method:          zhu #> Sample size:     n1 = 33, n2 = 33, total = 66 #> Expected events: 157.5 (n1: 98.3, n2: 59.2) #> Power: 80%, Alpha: 0.025 (1-sided) #> Rates: control = 0.5000, treatment = 0.3000 (RR = 0.6000) #> Dispersion: 0.1000, Avg exposure (calendar): 6.00 #> Avg exposure (at-risk): n1 = 5.96, n2 = 5.98 #> Accrual: 12.0, Trial duration: 12.0"},{"path":"https://keaven.github.io/gsDesignNB/articles/sample_size_nbinom.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Sample Size Calculation for Negative Binomial Outcomes","text":"Zhu, H., & Lakkis, H. (2014). Sample size calculation comparing two negative binomial rates clinical trials. Statistics Biopharmaceutical Research, 6(1), 107-115. Friede, T., & Schmidli, H. (2010). Sample size estimation clinical trials negative binomial rates. Methods Information Medicine, 49(6), 623-631. MÃ¼tze, T., Glimm, E., Schmidli, H., & Friede, T. (2018). Group sequential designs negative binomial outcomes. Statistical Methods Medical Research, 27(10), 2978-2993.","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"simulation-setup","dir":"Articles","previous_headings":"","what":"Simulation Setup","title":"Simulation of Recurrent Events","text":"simulate small trial following parameters: Enrollment: 20 patients total, recruited 5 months constant rate. Treatments: Two groups (Control vs.Â Experimental) 1:1 allocation ratio. Control: 0.5 events per year. Experimental: 0.3 events per year. Control: 10% annual dropout rate. Experimental: 5% annual dropout rate. Maximum Follow-: patient followed maximum 2 years randomization.","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"defining-input-parameters","dir":"Articles","previous_headings":"Simulation Setup","what":"Defining Input Parameters","title":"Simulation of Recurrent Events","text":"","code":"# Enrollment: rate of 4 patients/month for 5 months -> ~20 patients enroll_rate <- data.frame(   rate = 4,   duration = 5 )  # Failure rates (events per unit time) fail_rate <- data.frame(   treatment = c(\"Control\", \"Experimental\"),   rate = c(0.5, 0.3) # events per year (assuming time unit is year, adjust enroll duration if needed) )  # Let's ensure time units are consistent. # If fail_rate is per year, then durations should be in years. # 5 months = 5/12 years. enroll_rate <- data.frame(   rate = 20 / (5 / 12), # 20 patients over 5/12 years   duration = 5 / 12 )  # Dropout rates (per year) dropout_rate <- data.frame(   treatment = c(\"Control\", \"Experimental\"),   rate = c(0.1, 0.05),   duration = c(100, 100) # constant rate for long duration )  # Maximum follow-up per patient (years) max_followup <- 2"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"running-the-simulation","dir":"Articles","previous_headings":"","what":"Running the Simulation","title":"Simulation of Recurrent Events","text":"output contains multiple rows per subject: * event = 1: actual recurrent event. * event = 0: censoring time (either due dropout reaching max_followup).","code":"set.seed(123)  sim_data <- nb_sim(   enroll_rate = enroll_rate,   fail_rate = fail_rate,   dropout_rate = dropout_rate,   max_followup = max_followup,   n = 20 )  head(sim_data) #>   id id    treatment enroll_time       tte calendar_time event #> 1  1  1      Control  0.01757203 2.0000000     2.0175720     0 #> 2  2  2 Experimental  0.02958474 0.8651927     0.8947775     1 #> 3  2  2 Experimental  0.02958474 2.0000000     2.0295847     0 #> 4  3  3 Experimental  0.05727338 2.0000000     2.0572734     0 #> 5  4  4      Control  0.05793124 2.0000000     2.0579312     0 #> 6  5  5 Experimental  0.05910231 2.0000000     2.0591023     0"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"analyzing-the-data","dir":"Articles","previous_headings":"","what":"Analyzing the Data","title":"Simulation of Recurrent Events","text":"can aggregate data calculate observed event rates total follow-time group.","code":"sim_dt <- as.data.table(sim_data) sim_dt[, censor_followup := ifelse(event == 0, tte, 0)] summary_stats <- sim_dt[   ,   .(     n_subjects = uniqueN(id),     total_events = sum(event == 1),     total_followup = sum(censor_followup),     observed_rate = sum(event == 1) / sum(censor_followup)   ),   by = treatment ] summary_stats |>   gt() |>   tab_header(title = \"Summary Statistics by Treatment\") |>   cols_label(     treatment = \"Treatment\",     n_subjects = \"N\",     total_events = \"Events\",     total_followup = \"Follow-up\",     observed_rate = \"Rate\"   ) |>   fmt_number(columns = total_followup, decimals = 2) |>   fmt_number(columns = observed_rate, decimals = 3)"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"inspect-first-ten-records","dir":"Articles","previous_headings":"Analyzing the Data","what":"Inspect First Ten Records","title":"Simulation of Recurrent Events","text":"plotting, can look first ten records simulated dataset.","code":"head(sim_data, 10) #>    id id    treatment enroll_time       tte calendar_time event #> 1   1  1      Control  0.01757203 2.0000000     2.0175720     0 #> 2   2  2 Experimental  0.02958474 0.8651927     0.8947775     1 #> 3   2  2 Experimental  0.02958474 2.0000000     2.0295847     0 #> 4   3  3 Experimental  0.05727338 2.0000000     2.0572734     0 #> 5   4  4      Control  0.05793124 2.0000000     2.0579312     0 #> 6   5  5 Experimental  0.05910231 2.0000000     2.0591023     0 #> 7   6  6 Experimental  0.06569608 2.0000000     2.0656961     0 #> 8   7  7      Control  0.07224248 0.4510840     0.5233265     1 #> 9   7  7      Control  0.07224248 2.0000000     2.0722425     0 #> 10  8  8      Control  0.07526888 2.0000000     2.0752689     0"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"plotting-events","dir":"Articles","previous_headings":"Analyzing the Data","what":"Plotting Events","title":"Simulation of Recurrent Events","text":"can visualize events censoring times subject. avoid side-effects data.table, convert dataset back plain data frame. also display event gap event new events can recorded. illustration purposes plot, show 30-day gap visible timeline.","code":"sim_plot <- as.data.frame(sim_data) names(sim_plot) <- make.names(names(sim_plot), unique = TRUE) events_df <- sim_plot[sim_plot$event == 1, ] censor_df <- sim_plot[sim_plot$event == 0, ]  # Define a 30-day gap for visualization (default is usually 5 days) gap_duration <- 30 / 365.25  # Create segments for the gap after each event events_df$gap_start <- events_df$tte events_df$gap_end <- events_df$tte + gap_duration  ggplot(sim_plot, aes(x = tte, y = factor(id), color = treatment)) +   geom_line(aes(group = id), color = \"gray80\") +   # Add gap segments   geom_segment(     data = events_df,     aes(x = gap_start, xend = gap_end, y = factor(id), yend = factor(id)),     color = \"gray50\", linewidth = 2, alpha = 0.7   ) +   geom_point(data = events_df, shape = 19, size = 2) +   geom_point(data = censor_df, shape = 4, size = 3) +   labs(     title = \"Patient Timelines\",     x = \"Time from Randomization (Years)\",     y = \"Patient ID\",     caption = \"Dots = Events, Gray Bars = 30-day Gap, X = Censoring/Dropout\"   ) +   theme_minimal()"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"cutting-data-by-analysis-date","dir":"Articles","previous_headings":"","what":"Cutting Data by Analysis Date","title":"Simulation of Recurrent Events","text":"can truncate simulated data interim analysis date using cut_data_by_date(). function returns single record per participant truncated follow-time (tte) number observed events. default, 5-day gap (event_gap = 5 / 365.25) applied event, new events counted time risk excluded.","code":"cut_summary <- cut_data_by_date(sim_data, cut_date = 1.5) head(cut_summary) #>   id    treatment enroll_time      tte events #> 1  1      Control  0.01757203 1.482428      0 #> 2  2 Experimental  0.02958474 1.456726      1 #> 3  3 Experimental  0.05727338 1.442727      0 #> 4  4      Control  0.05793124 1.442069      0 #> 5  5 Experimental  0.05910231 1.440898      0 #> 6  6 Experimental  0.06569608 1.434304      0"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"wald-test-mÃ¼tze-et-al-","dir":"Articles","previous_headings":"","what":"Wald Test (MÃ¼tze et al.)","title":"Simulation of Recurrent Events","text":"Using truncated data can run Negative Binomial Wald test described MÃ¼tze et al.Â (2018).","code":"mutze_res <- mutze_test(cut_summary) mutze_res$group_summary |>   gt() |>   tab_header(title = \"MÃ¼tze Test: Group Summary\") |>   fmt_number(columns = c(events, exposure), decimals = 2) mutze_res$rate_ratio #> [1] 0.5273708"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"finding-analysis-date-for-target-events","dir":"Articles","previous_headings":"","what":"Finding Analysis Date for Target Events","title":"Simulation of Recurrent Events","text":"Often want perform interim analysis fixed calendar date, specific number events accumulated. can find date using get_analysis_date() cut data accordingly. function also respects event_gap (defaulting 5 days).","code":"# Target 15 total events target_events <- 15 analysis_date <- get_analysis_date(sim_data, planned_events = target_events) #> Only 11 events in trial  print(paste(\"Calendar date for\", target_events, \"events:\", round(analysis_date, 3))) #> [1] \"Calendar date for 15 events: 2.338\"  # Cut data at this date cut_events <- cut_data_by_date(sim_data, cut_date = analysis_date)  # Verify event count sum(cut_events$events) #> [1] 11"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"generating-and-verifying-negative-binomial-data","dir":"Articles","previous_headings":"","what":"Generating and Verifying Negative Binomial Data","title":"Simulation of Recurrent Events","text":"nb_sim() function can also generate data counts follow Negative Binomial distribution. achieved providing dispersion parameter fail_rate data frame. dispersion parameter kk relates variance mean Var(Y)=Î¼+kÎ¼2Var(Y) = \\mu + k\\mu^2.","code":""},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"simulation-with-dispersion","dir":"Articles","previous_headings":"Generating and Verifying Negative Binomial Data","what":"Simulation with Dispersion","title":"Simulation of Recurrent Events","text":"define scenario known dispersion 0.5.","code":"# Define failure rates with dispersion fail_rate_nb <- data.frame(   treatment = \"Control\",   rate = 10,       # Mean event rate   dispersion = 0.5 # Variance = mean + 0.5 * mean^2 )  enroll_rate_nb <- data.frame(   rate = 100,   duration = 1 )  set.seed(1) # Simulate 500 subjects to get a stable estimate sim_nb <- nb_sim(   enroll_rate = enroll_rate_nb,   fail_rate = fail_rate_nb,   max_followup = 1,   n = 500,   block = \"Control\" # Assign all to Control for simplicity )"},{"path":"https://keaven.github.io/gsDesignNB/articles/simulation_example.html","id":"verifying-the-dispersion-parameter","dir":"Articles","previous_headings":"Generating and Verifying Negative Binomial Data","what":"Verifying the Dispersion Parameter","title":"Simulation of Recurrent Events","text":"can verify simulated data reflects input dispersion parameter estimating back data. use Method Moments (MoM) estimator: kÌ‚=Var(Y)âˆ’Yâ€¾Yâ€¾2 \\hat{k} = \\frac{Var(Y) - \\bar{Y}}{\\bar{Y}^2}","code":"# Count events per subject counts_nb <- as.data.table(sim_nb)[, .(events = sum(event)), by = id]  m <- mean(counts_nb$events) v <- var(counts_nb$events) k_mom <- (v - m) / (m^2)  # Also estimate using GLM # We use MASS::glm.nb to fit the negative binomial model # We suppress warnings because fitting intercept-only models on simulated data # can occasionally produce convergence warnings despite valid estimates. k_glm <- tryCatch({   fit <- suppressWarnings(MASS::glm.nb(events ~ 1, data = counts_nb))   1 / fit$theta }, error = function(e) NA)  print(paste(\"True Dispersion:\", 0.5)) #> [1] \"True Dispersion: 0.5\" print(paste(\"Estimated Dispersion (MoM):\", signif(k_mom, 4))) #> [1] \"Estimated Dispersion (MoM): 0.5\" print(paste(\"Estimated Dispersion (GLM):\", signif(k_glm, 4))) #> [1] \"Estimated Dispersion (GLM): 0.512\""},{"path":"https://keaven.github.io/gsDesignNB/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Keaven Anderson. Author, maintainer.","code":""},{"path":"https://keaven.github.io/gsDesignNB/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Anderson K (2025). gsDesignNB: Sample Size Calculation Simulation Negative Binomial Outcomes. R package version 0.2.0, https://keaven.github.io/gsDesignNB/.","code":"@Manual{,   title = {gsDesignNB: Sample Size Calculation and Simulation for Negative Binomial Outcomes},   author = {Keaven Anderson},   year = {2025},   note = {R package version 0.2.0},   url = {https://keaven.github.io/gsDesignNB/}, }"},{"path":"https://keaven.github.io/gsDesignNB/index.html","id":"gsdesignnb","dir":"","previous_headings":"","what":"Sample Size Calculation and Simulation for Negative Binomial Outcomes","title":"Sample Size Calculation and Simulation for Negative Binomial Outcomes","text":"gsDesignNB provides fixed design group sequential design simulation recurrent event scenarios analyzed Poisson process negative binomial model. group sequential design, package can easily used gsDesign package. Key computation statistical information time analysis.","code":""},{"path":"https://keaven.github.io/gsDesignNB/index.html","id":"code-style","dir":"","previous_headings":"","what":"Code Style","title":"Sample Size Calculation and Simulation for Negative Binomial Outcomes","text":"package follows tidyverse style guide.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/blinded_ssr.html","id":null,"dir":"Reference","previous_headings":"","what":"Blinded Sample Size Re-estimation for Recurrent Events â€” blinded_ssr","title":"Blinded Sample Size Re-estimation for Recurrent Events â€” blinded_ssr","text":"Estimates blinded dispersion event rate aggregated interim data calculates required sample size maintain power, assuming planned treatment effect holds. function supports constant rates (Friede & Schmidli 2010) accommodates future extensions time-varying rates (Schneider et al. 2013) using exposure-adjusted rate.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/blinded_ssr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Blinded Sample Size Re-estimation for Recurrent Events â€” blinded_ssr","text":"","code":"blinded_ssr(   data,   ratio = 1,   lambda1_planning,   lambda2_planning,   power = 0.8,   alpha = 0.025,   method = \"friede\",   accrual_rate,   accrual_duration,   trial_duration,   dropout_rate = 0,   max_followup = NULL,   event_gap = NULL )"},{"path":"https://keaven.github.io/gsDesignNB/reference/blinded_ssr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Blinded Sample Size Re-estimation for Recurrent Events â€” blinded_ssr","text":"data data frame containing blinded interim data. Must include columns events (number events) tte (total exposure/follow-time). typically output cut_data_by_date(). ratio Planned allocation ratio (experimental / control). Default 1. lambda1_planning Planned event rate control group used original calculation. lambda2_planning Planned event rate experimental group used original calculation. power Target power (1 - beta). Default 0.8. alpha One-sided significance level. Default 0.025. method Method sample size recalculation. Currently \"friede\" (Friede & Schmidli 2010) implemented, uses blinded nuisance parameter estimates. accrual_rate Vector accrual rates (patients per unit time). accrual_duration Vector durations accrual rate. Must length accrual_rate. trial_duration Total planned duration trial. dropout_rate Dropout rate (hazard rate). Default 0. max_followup Maximum follow-time patient. Default NULL (infinite). event_gap Gap duration event new events counted. Default NULL (gap).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/blinded_ssr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Blinded Sample Size Re-estimation for Recurrent Events â€” blinded_ssr","text":"list containing: n_total_unadjusted Original planned total sample size (based planning parameters). n_total_blinded Re-estimated total sample size using blinded estimates. dispersion_blinded Estimated dispersion parameter (k) blinded data. lambda_blinded Estimated overall event rate blinded data. info_fraction Estimated information fraction interim (blinded information / target information). blinded_info Estimated statistical information blinded interim data. target_info Target statistical information required planned power.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/calculate_blinded_info.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Blinded Statistical Information â€” calculate_blinded_info","title":"Calculate Blinded Statistical Information â€” calculate_blinded_info","text":"Estimates blinded dispersion event rate aggregated interim data calculates observed statistical information log rate ratio, assuming planned allocation ratio treatment effect.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/calculate_blinded_info.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Blinded Statistical Information â€” calculate_blinded_info","text":"","code":"calculate_blinded_info(data, ratio = 1, lambda1_planning, lambda2_planning)"},{"path":"https://keaven.github.io/gsDesignNB/reference/calculate_blinded_info.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Blinded Statistical Information â€” calculate_blinded_info","text":"data data frame containing blinded interim data. Must include columns events (number events) tte (total exposure/follow-time). ratio Planned allocation ratio (experimental / control). Default 1. lambda1_planning Planned event rate control group. lambda2_planning Planned event rate experimental group.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/calculate_blinded_info.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Blinded Statistical Information â€” calculate_blinded_info","text":"list containing: blinded_info Estimated statistical information. dispersion_blinded Estimated dispersion parameter (k). lambda_blinded Estimated overall event rate. lambda1_adjusted Re-estimated control rate. lambda2_adjusted Re-estimated experimental rate.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/compute_info_at_time.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Statistical Information at Analysis Time â€” compute_info_at_time","title":"Compute Statistical Information at Analysis Time â€” compute_info_at_time","text":"Computes statistical information log rate ratio given analysis time, accounting staggered enrollment varying exposure times.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/compute_info_at_time.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Statistical Information at Analysis Time â€” compute_info_at_time","text":"","code":"compute_info_at_time(   analysis_time,   accrual_rate,   accrual_duration,   lambda1,   lambda2,   dispersion,   ratio = 1 )"},{"path":"https://keaven.github.io/gsDesignNB/reference/compute_info_at_time.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Statistical Information at Analysis Time â€” compute_info_at_time","text":"analysis_time calendar time analysis. accrual_rate enrollment rate (subjects per time unit). accrual_duration duration enrollment period. lambda1 Event rate group 1 (control). lambda2 Event rate group 2 (treatment). dispersion negative binomial dispersion parameter. ratio Allocation ratio (n2/n1). Default 1.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/compute_info_at_time.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Statistical Information at Analysis Time â€” compute_info_at_time","text":"statistical information (inverse variance) analysis time.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/compute_info_at_time.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Compute Statistical Information at Analysis Time â€” compute_info_at_time","text":"subjects enrolled time t, exposure analysis time T T - t. function integrates enrolled subjects compute total expected events variance log rate ratio. variance formula log rate ratio : $$Var = \\sum_i \\frac{1/\\mu_{1i} + k}{n_{1i}} + \\frac{1/\\mu_{2i} + k}{n_{2i}}$$ \\(\\mu_{ji} = \\lambda_j \\times exposure_i\\) \\(k\\) dispersion.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/compute_info_at_time.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Compute Statistical Information at Analysis Time â€” compute_info_at_time","text":"","code":"# Compute information at month 12 for a trial with: # - 10 subjects/month enrollment rate # - 20 month enrollment period # - Control event rate 0.5, treatment rate 0.3 # - Dispersion 0.1 compute_info_at_time(   analysis_time = 12,   accrual_rate = 10,   accrual_duration = 20,   lambda1 = 0.5,   lambda2 = 0.3,   dispersion = 0.1 ) #> [1] 55.10204"},{"path":"https://keaven.github.io/gsDesignNB/reference/cut_data_by_date.html","id":null,"dir":"Reference","previous_headings":"","what":"Cut nb_sim data by calendar date â€” cut_data_by_date","title":"Cut nb_sim data by calendar date â€” cut_data_by_date","text":"Cut nb_sim data calendar date","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/cut_data_by_date.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Cut nb_sim data by calendar date â€” cut_data_by_date","text":"","code":"cut_data_by_date(data, cut_date, event_gap = 5/365.25, ...)"},{"path":"https://keaven.github.io/gsDesignNB/reference/cut_data_by_date.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Cut nb_sim data by calendar date â€” cut_data_by_date","text":"data Data generated nb_sim(). cut_date Calendar time (relative trial start) censor follow-. event_gap Gap duration event new events counted. Can numeric value (default 5 / 365.25) function returning numeric value. time risk reduced sum gaps (truncated cut date). ... Additional arguments passed methods.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/cut_data_by_date.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Cut nb_sim data by calendar date â€” cut_data_by_date","text":"data frame one row per subject randomized prior cut_date containing truncated follow-time (tte) total number observed events (events).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/cut_data_by_date.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Cut nb_sim data by calendar date â€” cut_data_by_date","text":"","code":"enroll_rate <- data.frame(rate = 20 / (5 / 12), duration = 5 / 12) fail_rate <- data.frame(treatment = c(\"Control\", \"Experimental\"), rate = c(0.5, 0.3)) dropout_rate <- data.frame(   treatment = c(\"Control\", \"Experimental\"),   rate = c(0.1, 0.05), duration = c(100, 100) ) sim <- nb_sim(enroll_rate, fail_rate, dropout_rate, max_followup = 2, n = 20) cut_data_by_date(sim, cut_date = 1) #>    id    treatment enroll_time       tte events #> 1   1      Control   0.1078190 0.8784918      1 #> 2   2      Control   0.1255735 0.8744265      0 #> 3   3 Experimental   0.1352769 0.8647231      0 #> 4   4 Experimental   0.1466319 0.8533681      0 #> 5   5 Experimental   0.1471264 0.8391843      1 #> 6   6      Control   0.1674324 0.8325676      0 #> 7   7 Experimental   0.1945670 0.8054330      0 #> 8   8      Control   0.2352265 0.7647735      0 #> 9   9      Control   0.2624619 0.6964704      3 #> 10 10      Control   0.3061707 0.6664508      2 #> 11 11 Experimental   0.3321697 0.6678303      0 #> 12 12 Experimental   0.3363559 0.6636441      0 #> 13 13      Control   0.3770632 0.5955583      2 #> 14 14 Experimental   0.3778061 0.6221939      0 #> 15 15      Control   0.3859654 0.6140346      0 #> 16 16 Experimental   0.3938219 0.6061781      0 #> 17 17      Control   0.4692820 0.5307180      0 #> 18 18 Experimental   0.4778834 0.5221166      0 #> 19 19 Experimental   0.4804876 0.5058231      1 #> 20 20      Control   0.4879944 0.5120056      0"},{"path":"https://keaven.github.io/gsDesignNB/reference/get_analysis_date.html","id":null,"dir":"Reference","previous_headings":"","what":"Find calendar date for target event count â€” get_analysis_date","title":"Find calendar date for target event count â€” get_analysis_date","text":"Finds calendar time (since start randomization) specified total number events reached simulated dataset.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/get_analysis_date.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Find calendar date for target event count â€” get_analysis_date","text":"","code":"get_analysis_date(data, planned_events, event_gap = 5/365.25)"},{"path":"https://keaven.github.io/gsDesignNB/reference/get_analysis_date.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Find calendar date for target event count â€” get_analysis_date","text":"data data frame simulated data, typically nb_sim(). planned_events Integer. target number events. event_gap Gap duration event new events counted. Can numeric value (default 5 / 365.25) function returning numeric value.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/get_analysis_date.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Find calendar date for target event count â€” get_analysis_date","text":"Numeric. calendar date planned_events achieved. dataset contains fewer planned_events, returns maximum calendar time dataset prints message.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/get_analysis_date.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Find calendar date for target event count â€” get_analysis_date","text":"","code":"enroll_rate <- data.frame(rate = 20 / (5 / 12), duration = 5 / 12) fail_rate <- data.frame(treatment = c(\"Control\", \"Experimental\"), rate = c(0.5, 0.3)) dropout_rate <- data.frame(   treatment = c(\"Control\", \"Experimental\"),   rate = c(0.1, 0.05), duration = c(100, 100) ) sim <- nb_sim(enroll_rate, fail_rate, dropout_rate, max_followup = 2, n = 40) get_analysis_date(sim, planned_events = 15) #> [1] 1.257839"},{"path":"https://keaven.github.io/gsDesignNB/reference/gsNBCalendar.html","id":null,"dir":"Reference","previous_headings":"","what":"Group Sequential Design for Negative Binomial Outcomes â€” gsNBCalendar","title":"Group Sequential Design for Negative Binomial Outcomes â€” gsNBCalendar","text":"Creates group sequential design negative binomial outcomes based sample size calculations sample_size_nbinom.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/gsNBCalendar.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Group Sequential Design for Negative Binomial Outcomes â€” gsNBCalendar","text":"","code":"gsNBCalendar(   x,   k = 3,   test.type = 4,   alpha = 0.025,   beta = 0.1,   astar = 0,   delta = 0,   timing = 1,   sfu = gsDesign::sfHSD,   sfupar = -4,   sfl = gsDesign::sfHSD,   sflpar = -2,   tol = 1e-06,   r = 18,   usTime = NULL,   lsTime = NULL,   analysis_times = NULL )"},{"path":"https://keaven.github.io/gsDesignNB/reference/gsNBCalendar.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Group Sequential Design for Negative Binomial Outcomes â€” gsNBCalendar","text":"x object class sample_size_nbinom_result sample_size_nbinom. k Number analyses (interim + final). Default 3. test.type Test type gsDesign: 1 One-sided 2 Two-sided symmetric 3 Two-sided, asymmetric, binding futility bound, beta-spending 4 Two-sided, asymmetric, non-binding futility bound, beta-spending 5 Two-sided, asymmetric, binding futility bound, lower spending 6 Two-sided, asymmetric, non-binding futility bound, lower spending Default 4. alpha Type error (one-sided). Default 0.025. beta Type II error (1 - power). Default 0.1. astar Allocated Type error lower bound test.type = 5 6. Default 0. delta Standardized effect size. Default 0 (computed design). timing Timing interim analyses. May vector length k-1 values 0 1 representing information fractions. Default 1 (equally spaced). sfu Spending function upper bound. Default gsDesign::sfHSD. sfupar Parameter upper spending function. Default -4. sfl Spending function lower bound. Default gsDesign::sfHSD. sflpar Parameter lower spending function. Default -2. tol Tolerance convergence. Default 1e-06. r Integer controlling grid size numerical integration. Default 18. usTime Spending time upper bound (optional). lsTime Spending time lower bound (optional). analysis_times Optional vector calendar times analysis. provided, must length k. times stored T element displayed gsBoundSummary.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/gsNBCalendar.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Group Sequential Design for Negative Binomial Outcomes â€” gsNBCalendar","text":"object class gsNB inherits gsDesign sample_size_nbinom_result. Contains elements gsDesign::gsDesign() plus: nb_design original sample_size_nbinom_result object n1 Sample size per analysis group 1 n2 Sample size per analysis group 2 T Calendar time analysis (analysis_times provided)","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/gsNBCalendar.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Group Sequential Design for Negative Binomial Outcomes â€” gsNBCalendar","text":"Jennison, C. Turnbull, B.W. (2000), Group Sequential Methods Applications Clinical Trials. Boca Raton: Chapman Hall.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/gsNBCalendar.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Group Sequential Design for Negative Binomial Outcomes â€” gsNBCalendar","text":"","code":"# First create a sample size calculation nb_ss <- sample_size_nbinom(   lambda1 = 0.5, lambda2 = 0.3, dispersion = 0.1, power = 0.9,   accrual_rate = 10, accrual_duration = 20, trial_duration = 24 )  # Then create a group sequential design with analysis times gs_design <- gsNBCalendar(nb_ss, k = 3, test.type = 4,                          analysis_times = c(10, 18, 24))"},{"path":"https://keaven.github.io/gsDesignNB/reference/mutze_test.html","id":null,"dir":"Reference","previous_headings":"","what":"Wald test for treatment effect using Negative Binomial model (MÃ¼tze et al.) â€” mutze_test","title":"Wald test for treatment effect using Negative Binomial model (MÃ¼tze et al.) â€” mutze_test","text":"Fits Negative Binomial (Poisson) log-rate model aggregated subject-level data produced cut_data_by_date(). method matches Wald test described MÃ¼tze et al. (2018) comparing treatment arms recurrent event outcomes.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/mutze_test.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Wald test for treatment effect using Negative Binomial model (MÃ¼tze et al.) â€” mutze_test","text":"","code":"mutze_test(data, method = c(\"nb\", \"poisson\"), conf_level = 0.95)"},{"path":"https://keaven.github.io/gsDesignNB/reference/mutze_test.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Wald test for treatment effect using Negative Binomial model (MÃ¼tze et al.) â€” mutze_test","text":"data data frame least columns treatment, events, tte (follow-time). Typically output cut_data_by_date(). method Type model fit: \"nb\" (default) uses Negative Binomial GLM via MASS::glm.nb(), \"poisson\" fits Poisson GLM. conf_level Confidence level rate ratio interval. Default 0.95.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/mutze_test.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Wald test for treatment effect using Negative Binomial model (MÃ¼tze et al.) â€” mutze_test","text":"list containing fitted model summary elements: estimate: log rate ratio (experimental vs control). se: standard error log rate ratio. z: Wald statistic. p_value: two-sided p-value. rate_ratio: estimated rate ratio confidence interval. dispersion: estimated dispersion (theta) method = \"nb\". group_summary: observed subjects/events/exposure per treatment.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/mutze_test.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Wald test for treatment effect using Negative Binomial model (MÃ¼tze et al.) â€” mutze_test","text":"","code":"enroll_rate <- data.frame(rate = 20 / (5 / 12), duration = 5 / 12) fail_rate <- data.frame(treatment = c(\"Control\", \"Experimental\"), rate = c(0.5, 0.3)) dropout_rate <- data.frame(   treatment = c(\"Control\", \"Experimental\"),   rate = c(0.1, 0.05), duration = c(100, 100) ) sim <- nb_sim(enroll_rate, fail_rate, dropout_rate, max_followup = 2, n = 40) cut <- cut_data_by_date(sim, cut_date = 1.5) mutze_test(cut) #> $method #> [1] \"Negative Binomial Wald\" #>  #> $estimate #> [1] -0.4561103 #>  #> $se #> [1] 0.4564729 #>  #> $z #> [1] -0.9992057 #>  #> $p_value #> [1] 0.3176951 #>  #> $rate_ratio #> [1] 0.6337439 #>  #> $conf_int #> [1] 0.2590379 1.5504731 #>  #> $conf_level #> [1] 0.95 #>  #> $dispersion #> [1] 3256.233 #>  #> $model #>  #> Call:  MASS::glm.nb(formula = events ~ treatment + offset(log(tte)),  #>     data = df, init.theta = 3256.232807, link = log) #>  #> Coefficients: #>           (Intercept)  treatmentExperimental   #>               -0.4897                -0.4561   #>  #> Degrees of Freedom: 39 Total (i.e. Null);  38 Residual #> Null Deviance:\t    39.87  #> Residual Deviance: 38.85 \tAIC: 79.08 #>  #> $group_summary #>      treatment subjects events exposure #> 1 Experimental       20      8 20.59853 #> 2      Control       20     12 19.58128 #>"},{"path":"https://keaven.github.io/gsDesignNB/reference/nb_sim.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate Recurrent Events with Fixed Follow-up â€” nb_sim","title":"Simulate Recurrent Events with Fixed Follow-up â€” nb_sim","text":"Simulates recurrent events clinical trial piecewise constant enrollment, exponential failure rates (Poisson process), piecewise exponential dropout.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/nb_sim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate Recurrent Events with Fixed Follow-up â€” nb_sim","text":"","code":"nb_sim(   enroll_rate,   fail_rate,   dropout_rate = NULL,   max_followup = NULL,   n = NULL,   block = c(rep(\"Control\", 2), rep(\"Experimental\", 2)) )"},{"path":"https://keaven.github.io/gsDesignNB/reference/nb_sim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate Recurrent Events with Fixed Follow-up â€” nb_sim","text":"enroll_rate data frame columns rate duration defining piecewise constant enrollment rates. fail_rate data frame columns treatment rate defining exponential failure rate treatment group. Optionally, dispersion column can provided generate data Negative Binomial distribution. dispersion parameter k \\(Var(Y) = \\mu + k \\mu^2\\). dropout_rate data frame columns treatment, rate, duration defining piecewise constant dropout rates. max_followup Numeric. Maximum duration follow-individual (relative randomization time). n Total sample size. NULL, estimated enroll_rate. provided, enrollment stops n subjects recruited. block Block vector treatment allocation. Default c(rep(\"Control\", 2), rep(\"Experimental\", 2)). NULL, simple randomization used (treatments assigned equal probability). provided, specifies block structure, e.g., c(rep(\"\", 2), rep(\"B\", 2)) assigns 2 group 2 group B block.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/nb_sim.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulate Recurrent Events with Fixed Follow-up â€” nb_sim","text":"data frame (tibble) columns: id Subject identifier treatment Treatment group enroll_time Time enrollment relative trial start tte Time event censoring relative randomization calendar_time Calendar time event censoring (enroll_time + tte) event Binary indicator: 1 event, 0 censoring Multiple rows per subject returned (one event, plus one final censoring time).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/nb_sim.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Simulate Recurrent Events with Fixed Follow-up â€” nb_sim","text":"simulation generates data consistent Negative Binomial models described Friede Schmidli (2010) Mutze et al. (2018). Specifically, simulates Gamma-distributed frailty variable individual (dispersion > 0), acts multiplier individual's event rate. Events generated according Poisson process subject-specific rate.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/nb_sim.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Simulate Recurrent Events with Fixed Follow-up â€” nb_sim","text":"Friede, T., & Schmidli, H. (2010). Blinded sample size reestimation count data: methods applications. Statistics Medicine, 29(10), 1145-1156. Mutze, T., Glimm, E., Schmidli, H., & Friede, T. (2018). Blind sample size reestimation clinical trials recurrent event data. Pharmaceutical Statistics, 17(4), 369-383.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.gsNBsummary.html","id":null,"dir":"Reference","previous_headings":"","what":"Print Method for gsNBsummary Objects â€” print.gsNBsummary","title":"Print Method for gsNBsummary Objects â€” print.gsNBsummary","text":"Print Method gsNBsummary Objects","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.gsNBsummary.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Print Method for gsNBsummary Objects â€” print.gsNBsummary","text":"","code":"# S3 method for class 'gsNBsummary' print(x, ...)"},{"path":"https://keaven.github.io/gsDesignNB/reference/print.gsNBsummary.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Print Method for gsNBsummary Objects â€” print.gsNBsummary","text":"x object class gsNBsummary. ... Additional arguments (currently ignored).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.gsNBsummary.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Print Method for gsNBsummary Objects â€” print.gsNBsummary","text":"Invisibly returns input object.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.sample_size_nbinom_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Print Method for sample_size_nbinom_result Objects â€” print.sample_size_nbinom_result","title":"Print Method for sample_size_nbinom_result Objects â€” print.sample_size_nbinom_result","text":"Prints concise summary sample size calculation results.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.sample_size_nbinom_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Print Method for sample_size_nbinom_result Objects â€” print.sample_size_nbinom_result","text":"","code":"# S3 method for class 'sample_size_nbinom_result' print(x, ...)"},{"path":"https://keaven.github.io/gsDesignNB/reference/print.sample_size_nbinom_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Print Method for sample_size_nbinom_result Objects â€” print.sample_size_nbinom_result","text":"x object class sample_size_nbinom_result. ... Additional arguments (currently ignored).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.sample_size_nbinom_result.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Print Method for sample_size_nbinom_result Objects â€” print.sample_size_nbinom_result","text":"Invisibly returns input object.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.sample_size_nbinom_summary.html","id":null,"dir":"Reference","previous_headings":"","what":"Print Method for sample_size_nbinom_summary Objects â€” print.sample_size_nbinom_summary","title":"Print Method for sample_size_nbinom_summary Objects â€” print.sample_size_nbinom_summary","text":"Print Method sample_size_nbinom_summary Objects","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.sample_size_nbinom_summary.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Print Method for sample_size_nbinom_summary Objects â€” print.sample_size_nbinom_summary","text":"","code":"# S3 method for class 'sample_size_nbinom_summary' print(x, ...)"},{"path":"https://keaven.github.io/gsDesignNB/reference/print.sample_size_nbinom_summary.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Print Method for sample_size_nbinom_summary Objects â€” print.sample_size_nbinom_summary","text":"x object class sample_size_nbinom_summary. ... Additional arguments (currently ignored).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/print.sample_size_nbinom_summary.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Print Method for sample_size_nbinom_summary Objects â€” print.sample_size_nbinom_summary","text":"Invisibly returns input object.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/reexports.html","id":null,"dir":"Reference","previous_headings":"","what":"Objects exported from other packages â€” reexports","title":"Objects exported from other packages â€” reexports","text":"objects imported packages. Follow links see documentation. gsDesign gsBoundSummary, sfBetaDist, sfCauchy, sfExponential, sfExtremeValue, sfExtremeValue2, sfGapped, sfHSD, sfLDOF, sfLDPocock, sfLinear, sfLogistic, sfNormal, sfPoints, sfPower, sfStep, sfTDist, sfTrimmed, sfTruncated, sfXG1, sfXG2, sfXG3","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/sample_size_nbinom.html","id":null,"dir":"Reference","previous_headings":"","what":"Sample Size Calculation for Negative Binomial Distribution â€” sample_size_nbinom","title":"Sample Size Calculation for Negative Binomial Distribution â€” sample_size_nbinom","text":"Computes sample size comparing two treatment groups assuming negative binomial distribution outcome.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/sample_size_nbinom.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sample Size Calculation for Negative Binomial Distribution â€” sample_size_nbinom","text":"","code":"sample_size_nbinom(   lambda1,   lambda2,   dispersion,   power = NULL,   alpha = 0.025,   sided = 1,   ratio = 1,   accrual_rate,   accrual_duration,   trial_duration,   dropout_rate = 0,   max_followup = NULL,   event_gap = NULL,   method = \"zhu\" )"},{"path":"https://keaven.github.io/gsDesignNB/reference/sample_size_nbinom.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sample Size Calculation for Negative Binomial Distribution â€” sample_size_nbinom","text":"lambda1 Rate group 1 (control). lambda2 Rate group 2 (treatment). dispersion Dispersion parameter k \\(Var(Y) = \\mu + k \\mu^2\\). Note equivalent 1/size R's rnbinom parameterization. power Power test (1 - beta). Default 0.9. alpha Significance level. Default 0.025. sided One-sided two-sided test. 1 one-sided, 2 two-sided. Default 1. ratio Allocation ratio n2/n1. Default 1. accrual_rate Vector accrual rates (patients per unit time). accrual_duration Vector durations accrual rate. Must length accrual_rate. trial_duration Total planned duration trial. dropout_rate Dropout rate (hazard rate). Default 0. max_followup Maximum follow-time patient. Default NULL (infinite). event_gap Gap duration event new events counted. Default NULL (gap). provided, effective event rate reduced. method Method sample size calculation. \"zhu\" Zhu Lakkis (2014), \"friede\" Friede Schmidli (2010) / MÃ¼tze et al. (2018).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/sample_size_nbinom.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sample Size Calculation for Negative Binomial Distribution â€” sample_size_nbinom","text":"object class sample_size_nbinom_result, list containing: inputs Named list original function arguments. n1 Sample size group 1 n2 Sample size group 2 n_total Total sample size exposure Average exposure time used calculation (calendar time) exposure_at_risk_n1 Average -risk exposure time group 1 (accounts event gap) exposure_at_risk_n2 Average -risk exposure time group 2 (accounts event gap)","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/sample_size_nbinom.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Sample Size Calculation for Negative Binomial Distribution â€” sample_size_nbinom","text":"Zhu, H., & Lakkis, H. (2014). Sample size calculation comparing two negative binomial rates clinical trials. Statistics Biopharmaceutical Research, 6(1), 107-115. Friede, T., & Schmidli, H. (2010). Sample size estimation clinical trials negative binomial rates. Methods Information Medicine, 49(6), 623-631. MÃ¼tze, T., Glimm, E., Schmidli, H., & Friede, T. (2018). Group sequential designs negative binomial outcomes. Statistical Methods Medical Research, 27(10), 2978-2993.","code":""},{"path":[]},{"path":"https://keaven.github.io/gsDesignNB/reference/sample_size_nbinom.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Sample Size Calculation for Negative Binomial Distribution â€” sample_size_nbinom","text":"","code":"# Calculate sample size for lambda1 = 0.5, lambda2 = 0.3, dispersion = 0.1 # with fixed recruitment of 10/month for 20 months, 24 month trial duration x <- sample_size_nbinom(   lambda1 = 0.5, lambda2 = 0.3, dispersion = 0.1, power = 0.8,   accrual_rate = 10, accrual_duration = 20, trial_duration = 24 ) class(x) #> [1] \"sample_size_nbinom_result\" \"list\"                      summary(x) #> Fixed sample size design for negative binomial outcome (zhu method), total #> sample size 36 (n1=18, n2=18), 80 percent power, 2.5 percent (1-sided) Type I #> error. Control rate 0.5000, treatment rate 0.3000, risk ratio 0.6000, #> dispersion 0.1000. Accrual duration 20.0, trial duration 24.0, average exposure #> 14.00. Expected events 201.6. Randomization ratio 1:1. #>   # With piecewise accrual # 5 patients/month for 3 months, then 10 patients/month for 3 months # Trial ends at month 12. x2 <- sample_size_nbinom(   lambda1 = 0.5, lambda2 = 0.3, dispersion = 0.1, power = 0.8,   accrual_rate = c(5, 10), accrual_duration = c(3, 3),   trial_duration = 12 ) summary(x2) #> Fixed sample size design for negative binomial outcome (zhu method), total #> sample size 50 (n1=25, n2=25), 80 percent power, 2.5 percent (1-sided) Type I #> error. Control rate 0.5000, treatment rate 0.3000, risk ratio 0.6000, #> dispersion 0.1000. Accrual duration 6.0, trial duration 12.0, average exposure #> 8.50. Expected events 170.0. Randomization ratio 1:1. #>"},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.gsNB.html","id":null,"dir":"Reference","previous_headings":"","what":"Summary for gsNB Objects â€” summary.gsNB","title":"Summary for gsNB Objects â€” summary.gsNB","text":"Provides textual summary group sequential design negative binomial outcomes, similar summary provided gsDesign. tabular output, use gsBoundSummary directly gsNB object.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.gsNB.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summary for gsNB Objects â€” summary.gsNB","text":"","code":"# S3 method for class 'gsNB' summary(object, ...)"},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.gsNB.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summary for gsNB Objects â€” summary.gsNB","text":"object object class gsNB. ... Additional arguments (currently ignored).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.gsNB.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summary for gsNB Objects â€” summary.gsNB","text":"character string summarizing design (invisibly). summary also printed console.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.gsNB.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Summary for gsNB Objects â€” summary.gsNB","text":"","code":"nb_ss <- sample_size_nbinom(   lambda1 = 0.5, lambda2 = 0.3, dispersion = 0.1, power = 0.9,   accrual_rate = 10, accrual_duration = 20, trial_duration = 24 ) gs_design <- gsNBCalendar(nb_ss, k = 3) summary(gs_design) #> Asymmetric two-sided with non-binding futility bound group sequential design #> for negative binomial outcomes, 3 analyses, total sample size 51.4, 90 percent #> power, 2.5 percent (1-sided) Type I error. Control rate 0.5000, treatment rate #> 0.3000, risk ratio 0.6000, dispersion 0.1000. Accrual duration 20.0, trial #> duration 24.0, average exposure 14.00. Randomization ratio 1:1. #>   # For tabular bounds summary, use gsBoundSummary directly: # gsDesign::gsBoundSummary(gs_design)"},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.sample_size_nbinom_result.html","id":null,"dir":"Reference","previous_headings":"","what":"Summary for sample_size_nbinom_result Objects â€” summary.sample_size_nbinom_result","title":"Summary for sample_size_nbinom_result Objects â€” summary.sample_size_nbinom_result","text":"Provides textual summary sample size calculation negative binomial outcomes, similar summary gsNB objects.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.sample_size_nbinom_result.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summary for sample_size_nbinom_result Objects â€” summary.sample_size_nbinom_result","text":"","code":"# S3 method for class 'sample_size_nbinom_result' summary(object, ...)"},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.sample_size_nbinom_result.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summary for sample_size_nbinom_result Objects â€” summary.sample_size_nbinom_result","text":"object object class sample_size_nbinom_result. ... Additional arguments (currently ignored).","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.sample_size_nbinom_result.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summary for sample_size_nbinom_result Objects â€” summary.sample_size_nbinom_result","text":"character string summarizing design (invisibly). summary also printed console.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/summary.sample_size_nbinom_result.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Summary for sample_size_nbinom_result Objects â€” summary.sample_size_nbinom_result","text":"","code":"x <- sample_size_nbinom(   lambda1 = 0.5, lambda2 = 0.3, dispersion = 0.1, power = 0.8,   accrual_rate = 10, accrual_duration = 20, trial_duration = 24 ) class(x) #> [1] \"sample_size_nbinom_result\" \"list\"                      summary(x) #> Fixed sample size design for negative binomial outcome (zhu method), total #> sample size 36 (n1=18, n2=18), 80 percent power, 2.5 percent (1-sided) Type I #> error. Control rate 0.5000, treatment rate 0.3000, risk ratio 0.6000, #> dispersion 0.1000. Accrual duration 20.0, trial duration 24.0, average exposure #> 14.00. Expected events 201.6. Randomization ratio 1:1. #>"},{"path":"https://keaven.github.io/gsDesignNB/reference/toInteger.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert Group Sequential Design to Integer Sample Sizes â€” toInteger","title":"Convert Group Sequential Design to Integer Sample Sizes â€” toInteger","text":"Generic function round sample sizes group sequential design integers. extends toInteger function gsDesign package work gsNB objects.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/toInteger.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert Group Sequential Design to Integer Sample Sizes â€” toInteger","text":"","code":"toInteger(x, ...)  # S3 method for class 'gsDesign' toInteger(x, ratio = x$ratio, roundUpFinal = TRUE, ...)  # S3 method for class 'gsNB' toInteger(x, ratio = x$nb_design$inputs$ratio, roundUpFinal = TRUE, ...)"},{"path":"https://keaven.github.io/gsDesignNB/reference/toInteger.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert Group Sequential Design to Integer Sample Sizes â€” toInteger","text":"x object class gsNB gsDesign. ... Additional arguments passed methods. ratio Randomization ratio (n2/n1). integer provided, rounding done multiple ratio + 1. Default uses ratio original design. roundUpFinal TRUE (default), final sample size rounded ensure target met. FALSE, rounding nearest integer.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/toInteger.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert Group Sequential Design to Integer Sample Sizes â€” toInteger","text":"object class input integer sample sizes.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/toInteger.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Convert Group Sequential Design to Integer Sample Sizes â€” toInteger","text":"function rounds sample sizes analysis integers maintaining randomization ratio ensuring monotonically increasing sample sizes across analyses. final analysis sample size rounded integer; interim sample sizes remain expected (non-integer) values based information fraction. analysis_times provided gsNBCalendar, statistical information (n.) recomputed analysis time based new sample size expected exposures.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/toInteger.html","id":"methods-by-class-","dir":"Reference","previous_headings":"","what":"Methods (by class)","title":"Convert Group Sequential Design to Integer Sample Sizes â€” toInteger","text":"toInteger(gsDesign): Method gsDesign objects (calls gsDesign::toInteger) toInteger(gsNB): Method gsNB objects Rounds sample sizes group sequential negative binomial design integers, respecting randomization ratio.","code":""},{"path":"https://keaven.github.io/gsDesignNB/reference/toInteger.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert Group Sequential Design to Integer Sample Sizes â€” toInteger","text":"","code":"nb_ss <- sample_size_nbinom(   lambda1 = 0.5, lambda2 = 0.3, dispersion = 0.1, power = 0.9,   accrual_rate = 10, accrual_duration = 20, trial_duration = 24 ) gs_design <- gsNBCalendar(nb_ss, k = 3) gs_integer <- toInteger(gs_design)"}]
