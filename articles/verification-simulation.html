<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Verification of sample size calculation via simulation â€¢ gsDesignNB</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Verification of sample size calculation via simulation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsDesignNB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/keaven/gsDesignNB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Verification of sample size calculation via simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/keaven/gsDesignNB/blob/main/vignettes/verification-simulation.Rmd" class="external-link"><code>vignettes/verification-simulation.Rmd</code></a></small>
      <div class="d-none name"><code>verification-simulation.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keaven.github.io/gsDesignNB/">gsDesignNB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette verifies the accuracy of the
<code><a href="../reference/sample_size_nbinom.html">sample_size_nbinom()</a></code> function by comparing its theoretical
predictions for average exposure, statistical information, and power
against results from a large-scale simulation study.</p>
<p>We specifically test a scenario with:</p>
<ul>
<li>Piecewise constant accrual rates.</li>
<li>Piecewise exponential dropout (constant in this example).</li>
<li>Negative binomial outcomes.</li>
<li>Fixed follow-up design.</li>
</ul>
</div>
<div class="section level2">
<h2 id="simulation-design">Simulation design<a class="anchor" aria-label="anchor" href="#simulation-design"></a>
</h2>
<p>The study sample size suggested by the Friede method is used to
evaluate the accuracy of that method. The parameters for both the
theoretical calculation and the simulation study are as follows:</p>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<ul>
<li>
<strong>Rates</strong>: <span class="math inline">\(\lambda_1 =
0.4\)</span> (Control), <span class="math inline">\(\lambda_2 =
0.3\)</span> (Experimental).</li>
<li>
<strong>Dispersion</strong>: <span class="math inline">\(k =
0.5\)</span>.</li>
<li>
<strong>Power</strong>: 90%.</li>
<li>
<strong>Alpha</strong>: 0.025 (one-sided).</li>
<li>
<strong>Dropout</strong>: 10% per year adjusted to monthly rate
(<span class="math inline">\(\delta = 0.1 / 12\)</span>).</li>
<li>
<strong>Trial duration</strong>: 24 months.</li>
<li>
<strong>Max follow-up</strong>: 12 months.</li>
<li>
<strong>Event gap</strong>: 30 days (approx 0.082 years).</li>
<li>
<strong>Accrual</strong>: Piecewise linear ramp-up over 12 months
(Rate <span class="math inline">\(R\)</span> for 0-6mo, <span class="math inline">\(2R\)</span> for 6-12mo).</li>
</ul>
</div>
<div class="section level3">
<h3 id="theoretical-calculation">Theoretical calculation<a class="anchor" aria-label="anchor" href="#theoretical-calculation"></a>
</h3>
<p>First, we calculate the required sample size and expected properties
using <code><a href="../reference/sample_size_nbinom.html">sample_size_nbinom()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parameters</span></span>
<span><span class="va">lambda1</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span>
<span><span class="va">lambda2</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">dispersion</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">power</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.025</span></span>
<span><span class="va">dropout_rate</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="op">/</span> <span class="fl">12</span></span>
<span><span class="va">max_followup</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">trial_duration</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span><span class="va">event_gap</span> <span class="op">&lt;-</span> <span class="fl">20</span> <span class="op">/</span> <span class="fl">30.42</span> <span class="co"># 20 days</span></span>
<span></span>
<span><span class="co"># Accrual targeting 90% power</span></span>
<span><span class="co"># We provide relative rates (1:2) and the function scales them to achieve power</span></span>
<span><span class="va">accrual_rate_rel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">accrual_duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_size_nbinom.html">sample_size_nbinom</a></span><span class="op">(</span></span>
<span>  lambda1 <span class="op">=</span> <span class="va">lambda1</span>, lambda2 <span class="op">=</span> <span class="va">lambda2</span>, dispersion <span class="op">=</span> <span class="va">dispersion</span>,</span>
<span>  power <span class="op">=</span> <span class="va">power</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha</span>, sided <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  accrual_rate <span class="op">=</span> <span class="va">accrual_rate_rel</span>,</span>
<span>  accrual_duration <span class="op">=</span> <span class="va">accrual_duration</span>,</span>
<span>  trial_duration <span class="op">=</span> <span class="va">trial_duration</span>,</span>
<span>  dropout_rate <span class="op">=</span> <span class="va">dropout_rate</span>,</span>
<span>  max_followup <span class="op">=</span> <span class="va">max_followup</span>,</span>
<span>  event_gap <span class="op">=</span> <span class="va">event_gap</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract calculated absolute accrual rates</span></span>
<span><span class="va">accrual_rate</span> <span class="op">&lt;-</span> <span class="va">design</span><span class="op">$</span><span class="va">accrual_rate</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sample size for negative binomial outcome</span></span>
<span><span class="co">#&gt; ==========================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample size:     n1 = 211, n2 = 211, total = 422</span></span>
<span><span class="co">#&gt; Expected events: 1366.9 (n1: 763.1, n2: 603.8)</span></span>
<span><span class="co">#&gt; Power: 90%, Alpha: 0.025 (1-sided)</span></span>
<span><span class="co">#&gt; Rates: control = 0.4000, treatment = 0.3000 (RR = 0.7500)</span></span>
<span><span class="co">#&gt; Dispersion: 0.5000, Avg exposure (calendar): 11.42</span></span>
<span><span class="co">#&gt; Avg exposure (at-risk): n1 = 9.04, n2 = 9.54</span></span>
<span><span class="co">#&gt; Event gap: 0.66</span></span>
<span><span class="co">#&gt; Dropout rate: 0.0083</span></span>
<span><span class="co">#&gt; Accrual: 12.0, Trial duration: 24.0</span></span>
<span><span class="co">#&gt; Max follow-up: 12.0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulation-results">Simulation results<a class="anchor" aria-label="anchor" href="#simulation-results"></a>
</h2>
<p>We simulated 3,600 trials using the parameters defined above from the
Friede method. This number of simulations was chosen to achieve a
standard error for the power estimate of approximately 0.005 when the
true power is 90% (<span class="math inline">\(\sqrt{0.9 \times 0.1 /
3600} = 0.005\)</span>). The simulation script is located in
<code>data-raw/generate_simulation_data.R</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load pre-computed simulation results</span></span>
<span><span class="va">results_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simulation_results.rds"</span>, package <span class="op">=</span> <span class="st">"gsDesignNB"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">results_file</span> <span class="op">==</span> <span class="st">""</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../inst/extdata/simulation_results.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results_file</span> <span class="op">&lt;-</span> <span class="st">"../inst/extdata/simulation_results.rds"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">results_file</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">results_file</span><span class="op">)</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">results</span></span>
<span>  <span class="va">design_ref</span> <span class="op">&lt;-</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">design</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Fallback if data is not available (e.g. not installed yet)</span></span>
<span>  <span class="co"># This block allows the vignette to build without the data, but warns.</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"Simulation results not found. Skipping verification plots."</span><span class="op">)</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">design_ref</span> <span class="op">&lt;-</span> <span class="va">design</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="average-exposure-verification">1. Average exposure verification<a class="anchor" aria-label="anchor" href="#average-exposure-verification"></a>
</h3>
<p>We compare the theoretical average exposure calculated by
<code><a href="../reference/sample_size_nbinom.html">sample_size_nbinom()</a></code> with the observed average exposure in
the simulation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Theoretical Exposure</span></span>
<span><span class="va">theo_exposure</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">exposure</span></span>
<span></span>
<span><span class="co"># Observed Exposure (Average across all trials and arms)</span></span>
<span><span class="co"># Note: Exposure is the same for both arms in this design (randomized)</span></span>
<span><span class="va">obs_exposure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">exposure_control</span>, <span class="va">results</span><span class="op">$</span><span class="va">exposure_experimental</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Metric <span class="op">=</span> <span class="st">"Average Exposure"</span>,</span>
<span>  Theoretical <span class="op">=</span> <span class="va">theo_exposure</span>,</span>
<span>  Simulated <span class="op">=</span> <span class="va">obs_exposure</span>,</span>
<span>  Difference <span class="op">=</span> <span class="va">obs_exposure</span> <span class="op">-</span> <span class="va">theo_exposure</span>,</span>
<span>  Rel_Diff_Pct <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">obs_exposure</span> <span class="op">-</span> <span class="va">theo_exposure</span><span class="op">)</span> <span class="op">/</span> <span class="va">theo_exposure</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison_exp</span>, digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"Comparison of Average Exposure"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Comparison of Average Exposure</caption>
<thead><tr class="header">
<th align="left">Metric</th>
<th align="right">Theoretical</th>
<th align="right">Simulated</th>
<th align="right">Difference</th>
<th align="right">Rel_Diff_Pct</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Average Exposure</td>
<td align="right">11.4195</td>
<td align="right">11.3598</td>
<td align="right">-0.0597</td>
<td align="right">-0.5232</td>
</tr></tbody>
</table>
<p>The theoretical exposure should closely match the simulated average
exposure.</p>
</div>
<div class="section level3">
<h3 id="statistical-information-and-variance">2. Statistical information and variance<a class="anchor" aria-label="anchor" href="#statistical-information-and-variance"></a>
</h3>
<p>The theoretical variance of the log rate ratio estimator (Wald test)
is given by:</p>
<p><span class="math display">\[ V_{\text{theo}} = \frac{1/\mu_1 +
k_{\text{adj}}}{n_1} + \frac{1/\mu_2 + k_{\text{adj}}}{n_2}
\]</span></p>
<p>where <span class="math inline">\(\mu_i = \lambda_{i,\text{eff}}
\bar{t}\)</span> is the expected number of events per subject in group
<span class="math inline">\(i\)</span> (using effective rates adjusted
for event gaps), and <span class="math inline">\(k_{\text{adj}} = k
\cdot Q\)</span> is the dispersion parameter inflated for variable
follow-up.</p>
<p>The dispersion parameter <span class="math inline">\(k\)</span>
directly increases the variance of the estimator. In a standard Poisson
model, <span class="math inline">\(k=0\)</span>, and the variance
depends only on the expected number of events. With negative binomial
dispersion (<span class="math inline">\(k &gt; 0\)</span>), the variance
is inflated, reflecting the extra variability (overdispersion) in the
data.</p>
<p>We compare this with the variance of the estimates from the
simulation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Theoretical Variance (from design object)</span></span>
<span><span class="va">theo_var</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">variance</span></span>
<span></span>
<span><span class="co"># Empirical Variance of the Log Hazard Ratio estimates</span></span>
<span><span class="va">emp_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">estimate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Average Squared Standard Error (mean of the estimated variances)</span></span>
<span><span class="va">avg_se_sq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">se</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Variance of Estimator"</span><span class="op">)</span>,</span>
<span>  Theoretical <span class="op">=</span> <span class="va">theo_var</span>,</span>
<span>  Empirical_Var <span class="op">=</span> <span class="va">emp_var</span>,</span>
<span>  Avg_Estimated_Var <span class="op">=</span> <span class="va">avg_se_sq</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison_var</span>, digits <span class="op">=</span> <span class="fl">5</span>, caption <span class="op">=</span> <span class="st">"Comparison of Variance"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Comparison of Variance</caption>
<thead><tr class="header">
<th align="left">Metric</th>
<th align="right">Theoretical</th>
<th align="right">Empirical_Var</th>
<th align="right">Avg_Estimated_Var</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Variance of Estimator</td>
<td align="right">0.00786</td>
<td align="right">0.00755</td>
<td align="right">0.00728</td>
</tr></tbody>
</table>
<ul>
<li>
<strong>Empirical var</strong>: The actual variability of the
estimated log rate ratios across 3,600 trials.</li>
<li>
<strong>Avg estimated var</strong>: The average of the variance
estimates (<span class="math inline">\(\text{SE}^2\)</span>) produced by
the Wald test in each trial.</li>
</ul>
<p>While there is reasonable agreement, the sample size formula may
slightly underestimate the variability of the test statistic and thus
may overstate power.</p>
</div>
<div class="section level3">
<h3 id="power-verification">3. Power verification<a class="anchor" aria-label="anchor" href="#power-verification"></a>
</h3>
<p>Finally, we compare the theoretical power with the empirical power
(proportion of trials rejecting the null hypothesis).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Theoretical Power</span></span>
<span><span class="va">theo_power</span> <span class="op">&lt;-</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">power</span></span>
<span></span>
<span><span class="co"># Empirical Power</span></span>
<span><span class="va">emp_power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">p_value</span> <span class="op">&lt;</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">inputs</span><span class="op">$</span><span class="va">alpha</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_pwr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Metric <span class="op">=</span> <span class="st">"Power"</span>,</span>
<span>  Theoretical <span class="op">=</span> <span class="va">theo_power</span>,</span>
<span>  Simulated <span class="op">=</span> <span class="va">emp_power</span>,</span>
<span>  Difference <span class="op">=</span> <span class="va">emp_power</span> <span class="op">-</span> <span class="va">theo_power</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison_pwr</span>, digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"Comparison of Power"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Comparison of Power</caption>
<thead><tr class="header">
<th align="left">Metric</th>
<th align="right">Theoretical</th>
<th align="right">Simulated</th>
<th align="right">Difference</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Power</td>
<td align="right">0.9</td>
<td align="right">0.8739</td>
<td align="right">-0.0261</td>
</tr></tbody>
</table>
<p>A 95% confidence interval for the empirical power can be calculated
to check if the theoretical power falls within the simulation error
bounds.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html" class="external-link">binom.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">p_value</span> <span class="op">&lt;</span> <span class="va">design_ref</span><span class="op">$</span><span class="va">inputs</span><span class="op">$</span><span class="va">alpha</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span></span>
<span><span class="co">#&gt; [1] 0.8626014 0.8845653</span></span>
<span><span class="co">#&gt; attr(,"conf.level")</span></span>
<span><span class="co">#&gt; [1] 0.95</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The simulation results confirm that <code><a href="../reference/sample_size_nbinom.html">sample_size_nbinom()</a></code>
reasonably predicts average exposure, variance (information), and power
for this complex design with piecewise accrual and dropout. However,
given the slight underpowering that the simulation study suggests, it
may be useful to consider a larger sample size than the Friede
approximation suggests, with power verified by simulation.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
