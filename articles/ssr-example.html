<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Sample size re-estimation example • gsDesignNB</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sample size re-estimation example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gsDesignNB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/keaven/gsDesignNB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Sample size re-estimation example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/keaven/gsDesignNB/blob/main/vignettes/ssr-example.Rmd" class="external-link"><code>vignettes/ssr-example.Rmd</code></a></small>
      <div class="d-none name"><code>ssr-example.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keaven.github.io/gsDesignNB/">gsDesignNB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates a group sequential trial with a single
interim analysis where information-based sample size re-estimation (SSR)
is performed. We follow the methodology suggested by <span class="citation">Friede and Schmidli (2010)</span> for blinded sample
size re-estimation with negative binomial counts.</p>
<p>We simulate a single trial where the actual dispersion parameter is
higher than the planned dispersion parameter. This scenario typically
leads to a loss of power if the sample size is not adjusted. We will
show how to increase the sample size based on both blinded and unblinded
interim data to maintain the desired power.</p>
</div>
<div class="section level2">
<h2 id="trial-setup-and-initial-design">Trial setup and initial design<a class="anchor" aria-label="anchor" href="#trial-setup-and-initial-design"></a>
</h2>
<p>We plan a trial to compare two treatment groups (Control
vs. Experimental) with respect to recurrent event rates.</p>
<p><strong>Planned parameters:</strong></p>
<ul>
<li>Control rate (<span class="math inline">\(\lambda_1\)</span>): 2.0
events/year</li>
<li>Experimental rate (<span class="math inline">\(\lambda_2\)</span>):
1.5 events/year (Hazard Ratio = 0.75)</li>
<li>Dispersion (<span class="math inline">\(k\)</span>): 0.5</li>
<li>Power: 90%</li>
<li>One-sided Type I error (<span class="math inline">\(\alpha\)</span>): 0.025</li>
<li>Enrollment: 20 patients/month for 12 months</li>
<li>Study duration: 24 months (12 months accrual + 12 months
follow-up)</li>
</ul>
<p><strong>Actual parameters (simulation truth):</strong></p>
<ul>
<li>Dispersion (<span class="math inline">\(k\)</span>): 0.8 (Higher
than planned, implying higher variability)</li>
<li>Rates are as planned.</li>
</ul>
<div class="section level3">
<h3 id="initial-sample-size-calculation">Initial sample size calculation<a class="anchor" aria-label="anchor" href="#initial-sample-size-calculation"></a>
</h3>
<p>First, we calculate the required sample size under the
<em>planned</em> parameters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Planned parameters</span></span>
<span><span class="va">lambda1_plan</span> <span class="op">&lt;-</span> <span class="fl">2.0</span></span>
<span><span class="va">lambda2_plan</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">k_plan</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">power_plan</span> <span class="op">&lt;-</span> <span class="fl">0.9</span></span>
<span><span class="va">alpha_plan</span> <span class="op">&lt;-</span> <span class="fl">0.025</span></span>
<span><span class="va">accrual_rate_plan</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">accrual_dur_plan</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">trial_dur_plan</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span></span>
<span><span class="co"># Calculate sample size</span></span>
<span><span class="va">design_plan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_size_nbinom.html">sample_size_nbinom</a></span><span class="op">(</span></span>
<span>  lambda1 <span class="op">=</span> <span class="va">lambda1_plan</span>,</span>
<span>  lambda2 <span class="op">=</span> <span class="va">lambda2_plan</span>,</span>
<span>  dispersion <span class="op">=</span> <span class="va">k_plan</span>,</span>
<span>  power <span class="op">=</span> <span class="va">power_plan</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha_plan</span>,</span>
<span>  accrual_rate <span class="op">=</span> <span class="va">accrual_rate_plan</span>,</span>
<span>  accrual_duration <span class="op">=</span> <span class="va">accrual_dur_plan</span>,</span>
<span>  trial_duration <span class="op">=</span> <span class="va">trial_dur_plan</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">design_plan</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sample size for negative binomial outcome</span></span>
<span><span class="co">#&gt; ==========================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample size:     n1 = 140, n2 = 140, total = 280</span></span>
<span><span class="co">#&gt; Expected events: 8820.0 (n1: 5040.0, n2: 3780.0)</span></span>
<span><span class="co">#&gt; Power: 90%, Alpha: 0.025 (1-sided)</span></span>
<span><span class="co">#&gt; Rates: control = 2.0000, treatment = 1.5000 (RR = 0.7500)</span></span>
<span><span class="co">#&gt; Dispersion: 0.5000, Avg exposure (calendar): 18.00</span></span>
<span><span class="co">#&gt; Accrual: 12.0, Trial duration: 24.0</span></span></code></pre></div>
<p>The design requires a total of 280 patients.</p>
</div>
</div>
<div class="section level2">
<h2 id="simulation-of-a-single-trial">Simulation of a single trial<a class="anchor" aria-label="anchor" href="#simulation-of-a-single-trial"></a>
</h2>
<p>We simulate a single realization of the trial using the
<em>actual</em> parameters (higher dispersion).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Actual parameters</span></span>
<span><span class="va">k_true</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span>
<span><span class="va">lambda1_true</span> <span class="op">&lt;-</span> <span class="fl">2.0</span></span>
<span><span class="va">lambda2_true</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span></span>
<span><span class="co"># Enrollment and rates for simulation</span></span>
<span><span class="va">enroll_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="va">accrual_rate_plan</span>, duration <span class="op">=</span> <span class="va">accrual_dur_plan</span><span class="op">)</span></span>
<span><span class="va">fail_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Experimental"</span><span class="op">)</span>,</span>
<span>  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lambda1_true</span>, <span class="va">lambda2_true</span><span class="op">)</span>,</span>
<span>  dispersion <span class="op">=</span> <span class="va">k_true</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dropout_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Experimental"</span><span class="op">)</span>,</span>
<span>  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate trial</span></span>
<span><span class="co"># We simulate enough patients to cover the planned sample size and potential increase</span></span>
<span><span class="co"># Let's simulate a large pool and then we will cut it.</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nb_sim.html">nb_sim</a></span><span class="op">(</span></span>
<span>  enroll_rate <span class="op">=</span> <span class="va">enroll_rate</span>,</span>
<span>  fail_rate <span class="op">=</span> <span class="va">fail_rate</span>,</span>
<span>  dropout_rate <span class="op">=</span> <span class="va">dropout_rate</span>,</span>
<span>  max_followup <span class="op">=</span> <span class="va">trial_dur_plan</span>, <span class="co"># Max follow-up is effectively trial duration here</span></span>
<span>  n <span class="op">=</span> <span class="fl">400</span> <span class="co"># Simulate more than planned ~200 to allow for SSR increase</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id id    treatment enroll_time        tte calendar_time event</span></span>
<span><span class="co">#&gt; 1  1  1 Experimental   0.1250879 0.05426115     0.1793491     1</span></span>
<span><span class="co">#&gt; 2  1  1 Experimental   0.1250879 0.45662549     0.5817134     1</span></span>
<span><span class="co">#&gt; 3  1  1 Experimental   0.1250879 0.86838555     0.9934735     1</span></span>
<span><span class="co">#&gt; 4  1  1 Experimental   0.1250879 1.13483540     1.2599233     1</span></span>
<span><span class="co">#&gt; 5  1  1 Experimental   0.1250879 1.58643344     1.7115214     1</span></span>
<span><span class="co">#&gt; 6  1  1 Experimental   0.1250879 1.58735933     1.7124473     1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="interim-analysis">Interim analysis<a class="anchor" aria-label="anchor" href="#interim-analysis"></a>
</h2>
<p>We perform an interim analysis 9 months after the start of the trial.
At this point, enrollment is still ongoing (planned 12 months).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interim_time</span> <span class="op">&lt;-</span> <span class="fl">9</span></span>
<span></span>
<span><span class="co"># Cut data at interim</span></span>
<span><span class="va">interim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cut_data_by_date.html">cut_data_by_date</a></span><span class="op">(</span><span class="va">sim_data</span>, cut_date <span class="op">=</span> <span class="va">interim_time</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary of interim data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">interim_data</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Control Experimental </span></span>
<span><span class="co">#&gt;           90           91</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">interim_data</span><span class="op">$</span><span class="va">events</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1347</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="blinded-sample-size-re-estimation">Blinded sample size re-estimation<a class="anchor" aria-label="anchor" href="#blinded-sample-size-re-estimation"></a>
</h2>
<p>We use the <code><a href="../reference/blinded_ssr.html">blinded_ssr()</a></code> function to estimate the
nuisance parameters (dispersion and overall rate) from the blinded data
and recalculate the sample size.</p>
<p>The method assumes the treatment effect (rate ratio) is maintained as
planned, but updates the sample size based on the observed variance
structure.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform blinded SSR</span></span>
<span><span class="va">blinded_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blinded_ssr.html">blinded_ssr</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">interim_data</span>,</span>
<span>  ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lambda1_planning <span class="op">=</span> <span class="va">lambda1_plan</span>,</span>
<span>  lambda2_planning <span class="op">=</span> <span class="va">lambda2_plan</span>,</span>
<span>  power <span class="op">=</span> <span class="va">power_plan</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha_plan</span>,</span>
<span>  accrual_rate <span class="op">=</span> <span class="va">accrual_rate_plan</span>,</span>
<span>  accrual_duration <span class="op">=</span> <span class="va">accrual_dur_plan</span>,</span>
<span>  trial_duration <span class="op">=</span> <span class="va">trial_dur_plan</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">blinded_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $n_total_blinded</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;         440 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dispersion_blinded</span></span>
<span><span class="co">#&gt; [1] 0.8021666</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lambda_blinded</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;     1.73056 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lambda1_adjusted</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;    1.977783 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lambda2_adjusted</span></span>
<span><span class="co">#&gt; (Intercept) </span></span>
<span><span class="co">#&gt;    1.483337 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $info_fraction</span></span>
<span><span class="co">#&gt; [1] 0.3482652</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $blinded_info</span></span>
<span><span class="co">#&gt; [1] 44.21613</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $target_info</span></span>
<span><span class="co">#&gt; [1] 126.9611</span></span></code></pre></div>
<p>The blinded estimate of dispersion is 0.802, which is higher than the
planned 0.5. Consequently, the re-estimated sample size 440 is larger
than the planned 280.</p>
</div>
<div class="section level2">
<h2 id="unblinded-sample-size-re-estimation">Unblinded sample size re-estimation<a class="anchor" aria-label="anchor" href="#unblinded-sample-size-re-estimation"></a>
</h2>
<p>Alternatively, if the interim analysis is performed by an Independent
Data Monitoring Committee (IDMC) with access to unblinded data, we can
estimate the rates and dispersion separately for each group.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit Negative Binomial model to unblinded interim data</span></span>
<span><span class="co"># We use glm.nb from MASS package</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html" class="external-link">glm.nb</a></span><span class="op">(</span><span class="va">events</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">tte</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">interim_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm.nb(formula = events ~ treatment + offset(log(tte)), data = interim_data, </span></span>
<span><span class="co">#&gt;     init.theta = 1.269845637, link = log)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                       Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)             0.6875     0.1042   6.596 4.21e-11 ***</span></span>
<span><span class="co">#&gt; treatmentExperimental  -0.2938     0.1492  -1.969    0.049 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for Negative Binomial(1.2698) family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 200.87  on 180  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 197.03  on 179  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 1040.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;               Theta:  1.270 </span></span>
<span><span class="co">#&gt;           Std. Err.:  0.167 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  2 x log-likelihood:  -1034.284</span></span>
<span></span>
<span><span class="co"># Extract estimates</span></span>
<span><span class="co"># Intercept is log(lambda_control)</span></span>
<span><span class="co"># treatmentExperimental is log(RR)</span></span>
<span><span class="co"># theta is 1/k</span></span>
<span></span>
<span><span class="va">est_lambda1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">est_lambda2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"treatmentExperimental"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">est_k</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">fit</span><span class="op">$</span><span class="va">theta</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Unblinded Estimates:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unblinded Estimates:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Lambda 1:"</span>, <span class="va">est_lambda1</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Lambda 1: 1.98877</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Lambda 2:"</span>, <span class="va">est_lambda2</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Lambda 2: 1.482545</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dispersion (k):"</span>, <span class="va">est_k</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dispersion (k): 0.7874973</span></span>
<span></span>
<span><span class="co"># Recalculate sample size with unblinded estimates</span></span>
<span><span class="co"># We keep the original power and alpha</span></span>
<span><span class="va">unblinded_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_size_nbinom.html">sample_size_nbinom</a></span><span class="op">(</span></span>
<span>  lambda1 <span class="op">=</span> <span class="va">est_lambda1</span>,</span>
<span>  lambda2 <span class="op">=</span> <span class="va">est_lambda2</span>,</span>
<span>  dispersion <span class="op">=</span> <span class="va">est_k</span>,</span>
<span>  power <span class="op">=</span> <span class="va">power_plan</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha_plan</span>,</span>
<span>  accrual_rate <span class="op">=</span> <span class="va">accrual_rate_plan</span>,</span>
<span>  accrual_duration <span class="op">=</span> <span class="va">accrual_dur_plan</span>,</span>
<span>  trial_duration <span class="op">=</span> <span class="va">trial_dur_plan</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">unblinded_design</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sample size for negative binomial outcome</span></span>
<span><span class="co">#&gt; ==========================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample size:     n1 = 207, n2 = 207, total = 414</span></span>
<span><span class="co">#&gt; Expected events: 12934.1 (n1: 7410.2, n2: 5524.0)</span></span>
<span><span class="co">#&gt; Power: 90%, Alpha: 0.025 (1-sided)</span></span>
<span><span class="co">#&gt; Rates: control = 1.9888, treatment = 1.4825 (RR = 0.7455)</span></span>
<span><span class="co">#&gt; Dispersion: 0.7875, Avg exposure (calendar): 18.00</span></span>
<span><span class="co">#&gt; Accrual: 12.0, Trial duration: 24.0</span></span></code></pre></div>
<p>The unblinded re-estimation uses the observed rates and dispersion.
In this specific simulation, the observed dispersion 0.787 is close to
the true value 0.8. The rates might also fluctuate. The resulting sample
size 414 reflects the actual variability and effect size observed so
far.</p>
</div>
<div class="section level2">
<h2 id="comparison-and-conclusion">Comparison and conclusion<a class="anchor" aria-label="anchor" href="#comparison-and-conclusion"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Planned"</span>, <span class="st">"Blinded SSR"</span>, <span class="st">"Unblinded SSR"</span><span class="op">)</span>,</span>
<span>  Dispersion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">k_plan</span>, <span class="va">blinded_result</span><span class="op">$</span><span class="va">dispersion_blinded</span>, <span class="va">est_k</span><span class="op">)</span>,</span>
<span>  Sample_Size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">design_plan</span><span class="op">$</span><span class="va">n_total</span>, <span class="va">blinded_result</span><span class="op">$</span><span class="va">n_total_blinded</span>, <span class="va">unblinded_design</span><span class="op">$</span><span class="va">n_total</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison</span>, digits <span class="op">=</span> <span class="fl">3</span>, caption <span class="op">=</span> <span class="st">"Comparison of Sample Size Estimates"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Comparison of Sample Size Estimates</caption>
<thead><tr class="header">
<th align="left">Method</th>
<th align="right">Dispersion</th>
<th align="right">Sample_Size</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Planned</td>
<td align="right">0.500</td>
<td align="right">280</td>
</tr>
<tr class="even">
<td align="left">Blinded SSR</td>
<td align="right">0.802</td>
<td align="right">440</td>
</tr>
<tr class="odd">
<td align="left">Unblinded SSR</td>
<td align="right">0.787</td>
<td align="right">414</td>
</tr>
</tbody>
</table>
<p>In this example, the true dispersion was higher than planned. Both
blinded and unblinded SSR detected the increased variability and
suggested increasing the sample size to maintain power. The blinded
method is often preferred to maintain trial integrity, assuming the
treatment effect is not far from the planning assumption. The unblinded
method adapts to both the variance and the observed effect size, which
can lead to larger or smaller sample sizes depending on the observed
efficacy.</p>
<p><strong>Note:</strong> In practice, sample size is typically not
reduced if the re-estimated size is smaller than planned. We would take
<code>max(n_planned, n_reestimated)</code>.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-friede2010blinded" class="csl-entry">
Friede, T, and H Schmidli. 2010. <span>“Blinded Sample Size Reestimation
with Negative Binomial Counts in Superiority and Non-Inferiority
Trials.”</span> <em>Methods of Information in Medicine</em> 49 (06):
618–24.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaven Anderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
